/**
 * @author 3iPunt <https://www.tresipunt.com/>
 * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @copyright 3iPunt <https://www.tresipunt.com/>
 */
define("local_educaaragon/edittoc",["jquery","core/str","core/ajax","core/modal_factory","core/modal_events","core/templates","core/notification"],(function($,Str,Ajax,ModalFactory,ModalEvents,Templates,Notification){let ACTION_SAVECHANGES='[data-action="save-changes"]',ACTION_ADDNODE='[data-action="add-new-node"]',SERVICES_SAVECHANGES="local_educaaragon_savetocchanges",REGIONS_CONTENTEDITABLE="a[contenteditable=true]",REGIONS_TOCLISTCONTENT=".toc-list-content",REGIONS_EDITTITLE="i.edit-title",REGIONS_DELETENODE="i.delete-node",REGIONS_NEWNODE=".new-node",REGIONS_NEWNODEEDIT=".new-node i.edit-title",REGIONS_NEWNODEDELETE=".new-node i.delete-node",REGIONS_NEWNODECONTENTEDITABLE=".new-node a[contenteditable=true]",REGIONS_HASCHANGES=".haschanges",REGIONS_CONTENT_CONTROLS='[data-region="educaaragon-editresourcetoc"]',REGIONS_OVERLAY='[data-region="overlay-icon-container"]',REGIONS_DRAGGING="ul.sortable.dragaware",TEMPLATES_LOADING="core/overlay_loading",TEMPLATES_SUCCESS="core/notification_success",TEMPLATES_ERROR="core/notification_error";function Sortable(el,options){let $sortable=$(el),container_type=$sortable[0].nodeName,node_type="OL"===container_type||"UL"===container_type?"LI":"DIV",defaults={handle:!1,container:container_type,container_type:container_type,same_depth:!1,make_unselectable:!1,nodes:node_type,nodes_type:node_type,placeholder_class:null,auto_container_class:"sortable_container",autocreate:!1,group:!1,scroll:!1,update:null};this.$sortable=$sortable.data("sortable",this),this.options=$.extend({},defaults,options),this.init()}Sortable.prototype.invoke=function(command){let self=this;return"destroy"===command?self.destroy():"serialize"===command?self.serialize(self.$sortable):void 0};let hasChangesStrings,deleteNodeStrings,modalChanges,modalDelete,currentNodeToDelete,hasChanges=!1,hasChangesStringsKeys=[{key:"changesnotsaved",component:"local_educaaragon"},{key:"changesnotsaved_desc",component:"local_educaaragon"},{key:"savechanges",component:"local_educaaragon"}],deleteNode=[{key:"delete_node",component:"local_educaaragon"},{key:"delete_node_desc",component:"local_educaaragon"},{key:"delete_node",component:"local_educaaragon"}],alreadyLoaded=!1;function Draggable(el,options){this.$draggable=$(el).data("draggable",this),this.options=$.extend({},{handle:!1,delegate:!1,revert:!1,placeholder:!1,droptarget:!1,container:!1,scroll:!1,update:null,drop:null},options),this.init()}function Droppable(el,options){this.$droppable=$(el).data("droppable",this),this.options=$.extend({},{accept:!1,drop:null},options),this.init()}function Dragaware(el,options){let scrolltimeout,$dragaware=$(el),$reference=null,origin=null,lastpos=null;function evtpos(evt){return"touch"===(evt=window.hasOwnProperty("event")?window.event:evt).type.substring(0,5)&&(evt=(evt=evt.hasOwnProperty("originalEvent")?evt.originalEvent:evt).touches[0]),{pageX:evt.pageX,pageY:evt.pageY,clientX:evt.clientX,clientY:evt.clientY,dX:origin?evt.pageX-origin.pageX:0,dY:origin?evt.pageY-origin.pageY:0}}function autoscroll(pos){let sp=$dragaware.scrollParent(),mouse_x=pos.pageX,mouse_y=pos.pageY,offset=sp.offset(),scrollLeft=sp.scrollLeft(),scrollTop=sp.scrollTop(),width=sp.width(),height=sp.height();if(window.clearTimeout(scrolltimeout),scrollLeft>0&&mouse_x<offset.left)sp.scrollLeft(scrollLeft-options.scrollspeed);else if(scrollLeft<sp.prop("scrollWidth")-width&&mouse_x>offset.left+width)sp.scrollLeft(scrollLeft+options.scrollspeed);else if(scrollTop>0&&mouse_y<offset.top)sp.scrollTop(scrollTop-options.scrollspeed);else{if(!(scrollTop<sp.prop("scrollHeight")-height&&mouse_y>offset.top+height))return;sp.scrollTop(scrollTop+options.scrollspeed)}scrolltimeout=window.setTimeout((function(){autoscroll(pos)}),options.scrolltimeout)}function move(evt){if(lastpos=evtpos(evt),$(REGIONS_CONTENTEDITABLE).blur(),options.scroll&&autoscroll(lastpos),$reference.trigger("dragging"),options.drag)return options.drag.call($reference,evt,lastpos),!1}function end(evt){return $(REGIONS_CONTENTEDITABLE).blur(),window.clearTimeout(scrolltimeout),options.dragstop&&options.dragstop.call($reference,evt,lastpos),$reference.removeClass("dragging"),$reference.trigger("dragstop"),origin=!1,lastpos=!1,$reference=!1,$(document).off(".dragaware"),!1}options=$.extend({},{handle:null,delegate:null,scroll:!1,scrollspeed:15,scrolltimeout:50,dragstart:null,drag:null,dragstop:null},options),$dragaware.addClass("dragaware").on("touchstart.dragaware mousedown.dragaware",options.delegate,(function(evt){let $target=$(evt.target);if($reference=options.delegate?$target.closest(options.delegate):$dragaware,$target.closest(options.handle||"*").length&&("touchstart"==evt.type||0==evt.button))return origin=lastpos=evtpos(evt),options.dragstart&&options.dragstart.call($reference,evt,lastpos),$reference.addClass("dragging"),$reference.trigger("dragstart"),$(document).on("touchend.dragaware mouseup.dragaware click.dragaware",end).on("touchmove.dragaware mousemove.dragaware",move),!1})),$dragaware.on("destroy.dragaware",(function(){$dragaware.removeClass("dragaware").off(".dragaware")}))}function PositionHelper(origin){this.origin=origin}Sortable.prototype.init=function(){let $clone,$placeholder,origin,self=this;function find_insert_point($node,offset){let containers,best,depth;if(offset)return containers=self.$sortable.add(self.$sortable.find(self.options.container)).not($node.find(self.options.container)).not($clone.find(self.options.container)).not(self.find_nodes()),self.options.same_depth&&(depth=$node.parent().nestingDepth("ul"),containers=containers.filter((function(){return $(this).nestingDepth("ul")==depth}))),$placeholder.hide(),containers.each((function(ix,container){let $candidate,n,dist,$trailing=$(self.create_placeholder()).appendTo(container),$children=$(container).children(self.options.nodes).not(".sortable_clone");for(n=0;n<$children.length;n++)$candidate=$children.eq(n),dist=self.square_dist($candidate.offset(),offset),(!best||best.dist>dist)&&(best={container:container,before:$candidate[0],dist:dist});$trailing.remove()})),$placeholder.show(),best}function insert($element,best){let $container=$(best.container);best.before&&best.before.closest("html")?$element.insertBefore(best.before):$element.appendTo($container)}function moveCursorToEnd(el){if(void 0!==window.getSelection&&void 0!==document.createRange){let range=document.createRange();range.selectNodeContents(el),range.collapse(!1);let sel=window.getSelection();sel.removeAllRanges(),sel.addRange(range)}else if(void 0!==document.body.createTextRange){let textRange=document.body.createTextRange();textRange.moveToElementText(el),textRange.collapse(!1),textRange.select()}}self.options.make_unselectable&&$("html").unselectable(),self.$sortable.addClass("sortable").on("destroy.sortable",(function(){self.destroy()})),self.$sortable.dragaware($.extend({},self.options,{delegate:self.options.nodes,dragstart:function(){let $node=$(this);$clone=$node.clone().removeAttr("id").addClass("sortable_clone").css({position:"absolute"}).insertAfter($node).offset($node.offset()),$placeholder=self.create_placeholder().css({height:$node.outerHeight(),width:$node.outerWidth()}).insertAfter($node),$node.hide(),origin=new PositionHelper($clone.offset()),self.options.autocreate&&self.find_nodes().filter((function(ix,el){return 0===$(el).find(self.options.container).length})).append("<"+self.options.container_type+' class="'+self.options.auto_container_class+'"/>')},drag:function(evt,pos){let $node=$(this),offset=origin.absolutize(pos),best=find_insert_point($node,offset);$clone.offset(offset),insert($placeholder,best)},dragstop:function(evt,pos){let $node=$(this),best=find_insert_point($node,origin.absolutize(pos));best&&insert($node,best),$node.show(),$clone&&$clone.remove(),$placeholder&&$placeholder.remove(),$clone=null,$placeholder=null,best&&self.options.update&&(hasChanges=!0,self.options.update.call(self.$sortable,evt,self)),self.$sortable.trigger("update")}})),$(REGIONS_TOCLISTCONTENT).find("a").each((function(){if($(this).wrap('<div class="content-title d-flex flex-nowrap align-items-center justify-content-start"></div>'),"index.html"===$(this).attr("href")?($(this).removeAttr("class"),$(this).addClass("main-node"),$(this).after('<i class="edit-title icon fa fa-pencil fa-fw float-right ml-6" title="Edit Title" role="img" aria-label="Edit Title"></i>')):$(this).after('<i class="edit-title icon fa fa-pencil fa-fw float-right ml-6" title="Edit Title" role="img" aria-label="Edit Title"></i><i class="delete-node icon fa fa-trash fa-fw float-right ml-6" title="Delete Node" role="img" aria-label="Delete Node"></i>'),$(this).attr("contenteditable",!0),"index.html"===$(this).attr("href")){$(this).css({"font-weight":"bold",color:"red"});let liElement=$(this).closest("li");liElement.addClass("index-element").closest("ul").before(liElement)}})),$(REGIONS_EDITTITLE).off("touchstart.dragaware mousedown.dragaware click"),$(REGIONS_EDITTITLE).on("touchstart.dragaware mousedown.dragaware click",(function(e){e.stopPropagation(),moveCursorToEnd($(this).prev("a").attr("contenteditable","true").focus()[0])})),$(REGIONS_DELETENODE).off("touchstart.dragaware mousedown.dragaware click"),$(REGIONS_DELETENODE).on("touchstart.dragaware mousedown.dragaware click",(function(e){e.stopPropagation(),currentNodeToDelete=$(this).closest("li"),modalDelete.show()})),$(REGIONS_CONTENTEDITABLE).off("keydown"),$(REGIONS_CONTENTEDITABLE).on("keydown",(function(e){hasChanges=!0,$(REGIONS_HASCHANGES).css("display","block"),"Enter"===e.key&&(e.preventDefault(),$(this).blur())})),$(REGIONS_CONTENTEDITABLE).off("blur, focusout"),$(REGIONS_CONTENTEDITABLE).on("blur, focusout",(function(e){e.preventDefault(),e.stopPropagation(),""===$(this).text().trim()?($(this).attr("placeholder","El título no puede estar vacío"),$(this).focus(),$(this).css("background-color","#ffbfaf"),$(this).empty(),moveCursorToEnd(this)):$(this).css("background-color","unset")})),$(document).off("paste"),$(document).on("paste","[contenteditable]",(function(e){e.preventDefault();let text=(e.originalEvent||e).clipboardData.getData("text/plain");document.execCommand("insertText",!1,text)})),$(document).off("mousedown"),$(document).on("mousedown",(function(e){"write_comment"!==e.target.id&&(e.preventDefault(),e.stopPropagation(),$(REGIONS_CONTENTEDITABLE).blur())})),$(document).off("keydown"),$(document).on("keydown",(function(event){"Tab"===event.key&&(event.preventDefault(),$(REGIONS_CONTENTEDITABLE).blur())})),!1===alreadyLoaded&&(Sortable.prototype.createModalChanges(),Sortable.prototype.createModalDelete(),document.querySelectorAll('a:not([target="_blank"]), .content-controls button:not([data-action="save-changes"])').forEach((link=>{link.addEventListener("click",(e=>{hasChanges&&(e.preventDefault(),e.stopPropagation()),Sortable.prototype.detectChanges(e)}))})),window.onbeforeunload=function(e){Sortable.prototype.detectChanges(e),hasChanges&&e.preventDefault()},$(ACTION_SAVECHANGES).on("click",Sortable.prototype.saveChanges),$(ACTION_ADDNODE).on("click",Sortable.prototype.addNode)),alreadyLoaded=!0},Sortable.prototype.destroy=function(){this.options.make_unselectable&&$("html").unselectable("destroy"),this.$sortable.removeClass("sortable").off(".sortable").dragaware("destroy")},Sortable.prototype.serialize=function(container){let self=this;return container.children(self.options.nodes).not(self.options.container).map((function(ix,el){let $el=$(el),text=$el.clone().children().remove().end().text().trim(),node={id:$el.attr("id")||text};return $el.find(self.options.nodes).length&&(node.children=self.serialize($el.children(self.options.container))),node})).get()},Sortable.prototype.find_nodes=function(){return this.$sortable.find(this.options.nodes).not(this.options.container)},Sortable.prototype.create_placeholder=function(){return $("<"+this.options.nodes_type+"/>").addClass("sortable_placeholder").addClass(this.options.placeholder_class)},Sortable.prototype.square_dist=function(pos1,pos2){return Math.pow(pos2.left-pos1.left,2)+Math.pow(pos2.top-pos1.top,2)},Sortable.prototype.createModalChanges=function(){Str.get_strings(hasChangesStringsKeys).then((function(langStrings){hasChangesStrings=langStrings;let title=hasChangesStrings[0],confirmMessage=hasChangesStrings[1],buttonText=hasChangesStrings[2];return ModalFactory.create({title:title,body:confirmMessage,type:ModalFactory.types.SAVE_CANCEL}).then((function(modal){modal.setSaveButtonText(buttonText),modal.getRoot().on(ModalEvents.save,(function(){$(ACTION_SAVECHANGES).click(),modal.hide()})),modalChanges=modal})),!0}))},Sortable.prototype.createModalDelete=function(){Str.get_strings(deleteNode).then((function(langStrings){deleteNodeStrings=langStrings;let title=deleteNodeStrings[0],confirmMessage=deleteNodeStrings[1],buttonText=deleteNodeStrings[2];return ModalFactory.create({title:title,body:confirmMessage,type:ModalFactory.types.SAVE_CANCEL}).then((function(modal){modal.setSaveButtonText(buttonText),modal.getRoot().on(ModalEvents.save,(function(){currentNodeToDelete.remove(),modal.hide()})),modalDelete=modal})),!0}))},Sortable.prototype.detectChanges=function(){hasChanges&&modalChanges.show()},Sortable.prototype.saveChanges=function(e){e.preventDefault(),e.stopPropagation();let courseid=$(e.currentTarget).attr("data-courseid"),resourceid=$(e.currentTarget).attr("data-resourceid"),versionname=$(e.currentTarget).attr("data-versionname");Str.get_strings([{key:"save_changes",component:"local_educaaragon"},{key:"save_changes_desc",component:"local_educaaragon"},{key:"confirm",component:"local_educaaragon"},{key:"changes_saved",component:"local_educaaragon"},{key:"not_saved",component:"local_educaaragon"},{key:"write_comment",component:"local_educaaragon"}]).then((function(langStrings){let title=langStrings[0],confirmMessage=langStrings[1],buttonText=langStrings[2],htmlForBody="<p>"+confirmMessage+'</p><div class="col-xl-12"><div class="form-group purple-border mb-5"><label for="write_comment" class="">'+langStrings[5]+'</label><textarea maxlength="300" class="form-control" id="write_comment" rows="3"></textarea></div></div>',liElement=$(".index-element");liElement.removeClass("index-element").prependTo($(".toc-list-content").find("ul").first());let htmlContent=$(".toc-list-content ul:first-child").html(),html=$.parseHTML(htmlContent);$(html).find(REGIONS_EDITTITLE).each((function(){$(this).remove()})),$(html).find(REGIONS_DELETENODE).each((function(){$(this).remove()})),$(html).find(REGIONS_CONTENTEDITABLE).each((function(){$(this).removeAttr("contenteditable style").unwrap()})),$(html).find(".sortable_container").each((function(){$(this).removeAttr("class")})),$(html).each((function(){$(this).removeAttr("id style"),$(this).find("ul").each((function(){0===$(this).has("li").length&&$(this).remove()})),$(this).find("li").each((function(){$(this).removeAttr("id style")}))}));let cleanedHtml=$("<div>").append(html).html();return liElement.addClass("index-element").insertBefore(liElement.closest("ul")),ModalFactory.create({title:title,body:htmlForBody,type:ModalFactory.types.SAVE_CANCEL}).then((function(modal){return modal.setSaveButtonText(buttonText),modal.getRoot().on(ModalEvents.save,(function(e){e.preventDefault();let comment=$("#write_comment").val();comment.length>300&&(comment=comment.substring(0,300)),modal.hide();let request={methodname:SERVICES_SAVECHANGES,args:{courseid:courseid,resourceid:resourceid,versionname:versionname,html:cleanedHtml,other:btoa(comment)}};Templates.render(TEMPLATES_LOADING,{visible:!0}).done((function(html){$("body").append(html),Ajax.call([request])[0].done((function(response){const d=new Date;!0===response.response?(Templates.render(TEMPLATES_SUCCESS,{message:langStrings[3]+d.toTimeString().split(" ")[0],closebutton:!0,announce:!0}).done((function(htmlsuccess){$(REGIONS_CONTENT_CONTROLS).prepend(htmlsuccess)})),hasChanges=!1,$(REGIONS_NEWNODE).removeAttr("class"),$(REGIONS_HASCHANGES).css("display","none"),response.tochtml&&($(REGIONS_TOCLISTCONTENT).html(response.tochtml),$((function(){$(".toc-list-content ul:first-child").sortable({autocreate:!0,update:function(evt){hasChanges=!0,$(".haschanges").css("display","block")}})})))):Templates.render(TEMPLATES_ERROR,{message:langStrings[4],closebutton:!0,announce:!0}).done((function(htmlerror){$(REGIONS_CONTENT_CONTROLS).prepend(htmlerror)})),$(REGIONS_OVERLAY).remove()})).fail(Notification.exception)}))})),modal.getRoot().on(ModalEvents.hidden,(function(){modal.destroy()})),modal}))})).done((function(modal){modal.show(),$("#write_comment").focus()})).fail(Notification.exception)},Sortable.prototype.addNode=function(e){let htmlLi='<li class="new-node"><div class="content-title d-flex flex-nowrap align-items-center justify-content-start"><a href="" class="no-ch" contenteditable="true">Nuevo Elemento</a><i class="edit-title icon fa fa-pencil fa-fw float-right ml-6" title="Edit Title" role="img" aria-label="Edit Title"></i><i class="delete-node icon fa fa-trash fa-fw float-right ml-6" title="Delete Node" role="img" aria-label="Delete Node"></i></div></li>';if($(e.currentTarget).hasClass("forprev")){let targetLi=$(REGIONS_DRAGGING).find('a[href="index.html"]').closest("li");targetLi.length?$(htmlLi).insertAfter(targetLi):$(REGIONS_DRAGGING).prepend(htmlLi)}else $(REGIONS_DRAGGING).append(htmlLi);hasChanges=!0,$(".haschanges").css("display","block"),$(REGIONS_NEWNODEEDIT).off("touchstart.dragaware mousedown.dragaware click"),$(REGIONS_NEWNODEDELETE).off("touchstart.dragaware mousedown.dragaware click"),$(REGIONS_NEWNODECONTENTEDITABLE).off("keydown"),$(REGIONS_NEWNODECONTENTEDITABLE).off("blur, focusout"),$(REGIONS_NEWNODEEDIT).on("touchstart.dragaware mousedown.dragaware click",(function(e){e.stopPropagation();let editableElement=$(this).prev("a").attr("contenteditable","true").focus();if(void 0!==window.getSelection&&void 0!==document.createRange){let range=document.createRange();range.selectNodeContents(editableElement[0]),range.collapse(!1);let sel=window.getSelection();sel.removeAllRanges(),sel.addRange(range)}else if(void 0!==document.body.createTextRange){let textRange=document.body.createTextRange();textRange.moveToElementText(editableElement[0]),textRange.collapse(!1),textRange.select()}})),$(REGIONS_NEWNODEDELETE).on("touchstart.dragaware mousedown.dragaware click",(function(e){e.stopPropagation(),currentNodeToDelete=$(this).closest("li"),modalDelete.show()})),$(REGIONS_NEWNODECONTENTEDITABLE).on("keydown",(function(e){hasChanges=!0,$(REGIONS_HASCHANGES).css("display","block"),"Enter"===e.key&&(e.preventDefault(),$(this).blur())})),$(REGIONS_NEWNODECONTENTEDITABLE).on("blur, focusout",(function(e){if(e.preventDefault(),e.stopPropagation(),""===$(this).text().trim()){if($(this).attr("placeholder","El título no puede estar vacío"),$(this).focus(),$(this).css("background-color","#ffbfaf"),$(this).empty(),void 0!==window.getSelection&&void 0!==document.createRange){let range=document.createRange();range.selectNodeContents(this),range.collapse(!1);let sel=window.getSelection();sel.removeAllRanges(),sel.addRange(range)}else if(void 0!==document.body.createTextRange){let textRange=document.body.createTextRange();textRange.moveToElementText(this),textRange.collapse(!1),textRange.select()}}else $(this).css("background-color","unset")})),$(e.currentTarget).hasClass("forprev")?$(REGIONS_NEWNODEEDIT).first().click():$(REGIONS_NEWNODEEDIT).last().click()},Draggable.prototype.init=function(){let $clone,origin,self=this;function check_droptarget(pos){let $over;if($(".hovering").removeClass("hovering"),$clone.hide(),$over=$(document.elementFromPoint(pos.clientX,pos.clientY)).closest(self.options.droptarget),$clone.show(),$over.length)return $over.addClass("hovering"),$over}self.$draggable.addClass("draggable").on("destroy.draggable",(function(){self.destroy()})),self.$draggable.dragaware($.extend({},self.options,{dragstart:function(){let $this=$(this);self.options.placeholder||self.options.revert?($clone=$this.clone().removeAttr("id").addClass("draggable_clone").css({position:"absolute"}).appendTo(self.options.container||$this.parent()).offset($this.offset()),self.options.placeholder||$(this).invisible()):$clone=$this,origin=new PositionHelper($clone.offset())},drag:function(evt,pos){check_droptarget(pos);$clone.offset(origin.absolutize(pos))},dragstop:function(evt,pos){let $this=$(this),$droptarget=check_droptarget(pos);(self.options.revert||self.options.placeholder)&&($this.visible(),self.options.revert||$this.offset(origin.absolutize(pos)),$clone.remove()),$clone=null,self.options.update&&(hasChanges=!0,self.options.update.call($this,evt,self)),$this.trigger("update"),$droptarget?(self.options.drop&&self.options.drop.call($this,evt,$droptarget[0]),$droptarget.trigger("drop",[$this]),$droptarget.removeClass("hovering")):self.options.onrevert&&self.options.onrevert.call($this,evt)}}))},Draggable.prototype.destroy=function(){this.$draggable.dragaware("destroy").removeClass("draggable").off(".draggable")},Droppable.prototype.init=function(){let self=this;self.$droppable.addClass("droppable").on("drop",(function(evt,$draggable){self.options.accept&&!$draggable.is(self.options.accept)||self.options.drop&&self.options.drop.call(self.$droppable,evt,$draggable)})).on("destroy.droppable",(function(){self.destroy()}))},Droppable.prototype.destroy=function(){this.$droppable.removeClass("droppable").off(".droppable")},PositionHelper.prototype.absolutize=function(pos){return pos?{top:this.origin.top+pos.dY,left:this.origin.left+pos.dX}:this.origin},$.fn.sortable=function(options){let filtered=this.not((function(){return $(this).is(".sortable")||$(this).closest(".sortable").length}));return this.data("sortable")&&"string"==typeof options?this.data("sortable").invoke(options):(filtered.length&&options&&options.group?new Sortable(filtered,options):filtered.each((function(ix,el){new Sortable(el,options)})),this)},$.fn.draggable=function(options){return"destroy"===options?this.trigger("destroy.draggable"):this.not(".draggable").each((function(ix,el){new Draggable(el,options)})),this},$.fn.droppable=function(options){return"destroy"===options?this.trigger("destroy.droppable"):this.not(".droppable").each((function(ix,el){new Droppable(el,options)})),this},$.fn.dragaware=function(options){return"destroy"===options?this.trigger("destroy.dragaware"):this.not(".dragaware").each((function(ix,el){new Dragaware(el,options)})),this},$.fn.unselectable=function(command){return"destroy"===command?this.removeClass("unselectable").removeAttr("unselectable").off("selectstart.unselectable"):this.addClass("unselectable").attr("unselectable","on").on("selectstart.unselectable",(function(){return!1}))},$.fn.invisible=function(){return this.css({visibility:"hidden"})},$.fn.visible=function(){return this.css({visibility:"visible"})},$.fn.scrollParent=function(){return this.parents().addBack().filter((function(){let p=$(this);return/(scroll|auto)/.test(p.css("overflow-x")+p.css("overflow-y")+p.css("overflow"))}))},$.fn.nestingDepth=function(selector){let parent=this.parent().closest(selector||"*");return parent.length?parent.nestingDepth(selector)+1:0}}));

//# sourceMappingURL=edittoc.min.js.map