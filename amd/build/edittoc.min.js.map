{"version":3,"file":"edittoc.min.js","sources":["../src/edittoc.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @author 3iPunt <https://www.tresipunt.com/>\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @copyright 3iPunt <https://www.tresipunt.com/>\n */\n/* eslint-disable jsdoc/require-param-type */\n/* eslint-disable camelcase */\n/* eslint-disable no-unused-vars */\n/* eslint-disable no-console */\ndefine([\n    'jquery',\n    'core/str',\n    'core/ajax',\n    'core/modal_factory',\n    'core/modal_events',\n    'core/templates',\n    'core/notification'\n], function($, Str, Ajax, ModalFactory, ModalEvents, Templates, Notification) {\n    \"use strict\";\n\n    let ACTION = {\n        SAVECHANGES: '[data-action=\"save-changes\"]',\n        ADDNODE: '[data-action=\"add-new-node\"]'\n    };\n\n    let SERVICES = {\n        SAVECHANGES: 'local_educaaragon_savetocchanges',\n    };\n\n    let REGIONS = {\n        CONTENTEDITABLE: 'a[contenteditable=true]',\n        TOCLISTCONTENT: '.toc-list-content',\n        EDITTITLE: 'i.edit-title',\n        DELETENODE: 'i.delete-node',\n        NEWNODE: '.new-node',\n        NEWNODEEDIT: '.new-node i.edit-title',\n        NEWNODEDELETE: '.new-node i.delete-node',\n        NEWNODECONTENTEDITABLE: '.new-node a[contenteditable=true]',\n        HASCHANGES: '.haschanges',\n        CONTENT_CONTROLS: '[data-region=\"educaaragon-editresourcetoc\"]',\n        OVERLAY: '[data-region=\"overlay-icon-container\"]',\n        DRAGGING: 'ul.sortable.dragaware'\n    };\n\n    let TEMPLATES = {\n        LOADING: 'core/overlay_loading',\n        SUCCESS: 'core/notification_success',\n        ERROR: 'core/notification_error'\n    };\n\n    /**\n     * @constructor\n     * @param el\n     * @param options\n     */\n    function Sortable(el, options) {\n        let self = this,\n            $sortable = $(el),\n            container_type = $sortable[0].nodeName,\n            node_type = (container_type === 'OL' || container_type === 'UL') ? 'LI' : 'DIV',\n            defaults = {\n                handle: false,\n                container: container_type,\n                container_type: container_type,\n                same_depth: false,\n                make_unselectable: false,\n                nodes: node_type,\n                nodes_type: node_type,\n                placeholder_class: null,\n                auto_container_class: 'sortable_container',\n                autocreate: false,\n                group: false,\n                scroll: false,\n                update: null\n            };\n        self.$sortable = $sortable.data('sortable', self);\n        self.options = $.extend({}, defaults, options);\n        self.init();\n    }\n\n    Sortable.prototype.invoke = function(command) {\n        let self = this;\n        if (command === 'destroy') {\n            return self.destroy();\n        } else if (command === 'serialize') {\n            return self.serialize(self.$sortable);\n        }\n    };\n\n    let hasChanges = false;\n    let hasChangesStringsKeys = [\n        {key: 'changesnotsaved', component: 'local_educaaragon'},\n        {key: 'changesnotsaved_desc', component: 'local_educaaragon'},\n        {key: 'savechanges', component: 'local_educaaragon'}\n    ];\n    let deleteNode = [\n        {key: 'delete_node', component: 'local_educaaragon'},\n        {key: 'delete_node_desc', component: 'local_educaaragon'},\n        {key: 'delete_node', component: 'local_educaaragon'}\n    ];\n    let hasChangesStrings;\n    let deleteNodeStrings;\n    let modalChanges;\n    let modalDelete;\n    let currentNodeToDelete;\n    let alreadyLoaded = false;\n\n    Sortable.prototype.init = function() {\n        let self = this,\n            $clone,\n            $placeholder,\n            origin;\n        if (self.options.make_unselectable) {\n            $('html').unselectable();\n        }\n        self.$sortable\n            .addClass('sortable')\n            .on('destroy.sortable', function() {\n                self.destroy();\n            });\n\n        /**\n         *\n         * @param $node\n         * @param offset\n         */\n        function find_insert_point($node, offset) {\n            let containers,\n                best,\n                depth;\n\n            if (!offset) {\n                return;\n            }\n\n            containers = self.$sortable\n                .add(self.$sortable.find(self.options.container))\n                .not($node.find(self.options.container))\n                .not($clone.find(self.options.container))\n                .not(self.find_nodes());\n\n            if (self.options.same_depth) {\n                depth = $node.parent().nestingDepth('ul');\n                containers = containers.filter(function() {\n                    return $(this).nestingDepth('ul') == depth;\n                });\n            }\n\n            $placeholder.hide();\n            containers.each(function(ix, container) {\n                let $trailing = $(self.create_placeholder()).appendTo(container),\n                    $children = $(container).children(self.options.nodes).not('.sortable_clone'),\n                    $candidate,\n                    n,\n                    dist;\n\n                for (n = 0; n < $children.length; n++) {\n                    $candidate = $children.eq(n);\n                    dist = self.square_dist($candidate.offset(), offset);\n                    if (!best || best.dist > dist) {\n                        best = {container: container, before: $candidate[0], dist: dist};\n                    }\n                }\n\n                $trailing.remove();\n            });\n            $placeholder.show();\n\n            return best;\n        }\n\n        /**\n         *\n         * @param $element\n         * @param best\n         */\n        function insert($element, best) {\n            let $container = $(best.container);\n            if (best.before && best.before.closest('html')) {\n                $element.insertBefore(best.before);\n            } else {\n                $element.appendTo($container);\n            }\n        }\n\n        self.$sortable.dragaware($.extend({}, self.options, {\n            delegate: self.options.nodes,\n            dragstart: function() {\n                let $node = $(this);\n\n                $clone = $node.clone()\n                    .removeAttr('id')\n                    .addClass('sortable_clone')\n                    .css({position: 'absolute'})\n                    .insertAfter($node)\n                    .offset($node.offset());\n                $placeholder = self.create_placeholder()\n                    .css({height: $node.outerHeight(), width: $node.outerWidth()})\n                    .insertAfter($node);\n                $node.hide();\n\n                origin = new PositionHelper($clone.offset());\n\n                if (self.options.autocreate) {\n                    self.find_nodes().filter(function(ix, el) {\n                        return $(el).find(self.options.container).length === 0;\n                    }).append('<' + self.options.container_type + ' class=\"' + self.options.auto_container_class + '\"/>');\n                }\n            },\n\n            /**\n             * Drag - reposition clone, check for best insert position, move placeholder in dom accordingly.\n             * @param evt\n             * @param pos\n             */\n            drag: function(evt, pos) {\n                let $node = $(this),\n                    offset = origin.absolutize(pos),\n                    best = find_insert_point($node, offset);\n\n                $clone.offset(offset);\n                insert($placeholder, best);\n            },\n\n            /**\n             * Drag stop - clean up.\n             * @param evt\n             * @param pos\n             */\n            dragstop: function(evt, pos) {\n                let $node = $(this),\n                    offset = origin.absolutize(pos),\n                    best = find_insert_point($node, offset);\n\n                if (best) {\n                    insert($node, best);\n                }\n                $node.show();\n\n                if ($clone) {\n                    $clone.remove();\n                }\n                if ($placeholder) {\n                    $placeholder.remove();\n                }\n                $clone = null;\n                $placeholder = null;\n\n                if (best && self.options.update) {\n                    hasChanges = true;\n                    self.options.update.call(self.$sortable, evt, self);\n                }\n                self.$sortable.trigger('update');\n            }\n        }));\n\n        /* Links controls */\n        $(REGIONS.TOCLISTCONTENT).find('a').each(function() {\n            $(this).wrap('<div class=\"content-title d-flex flex-nowrap align-items-center justify-content-start\"></div>');\n            if ($(this).attr('href') === 'index.html') {\n                $(this).removeAttr('class');\n                $(this).addClass('main-node');\n                $(this).after('<i class=\"edit-title icon fa fa-pencil fa-fw float-right ml-6\" title=\"Edit Title\" role=\"img\"' +\n                    ' aria-label=\"Edit Title\"></i>');\n            } else {\n                $(this).after('<i class=\"edit-title icon fa fa-pencil fa-fw float-right ml-6\" title=\"Edit Title\" role=\"img\"' +\n                    ' aria-label=\"Edit Title\"></i>' +\n                    '<i class=\"delete-node icon fa fa-trash fa-fw float-right ml-6\" title=\"Delete Node\" role=\"img\"' +\n                    ' aria-label=\"Delete Node\"></i>');\n            }\n            $(this).attr('contenteditable', true);\n            if ($(this).attr('href') === 'index.html') {\n                $(this).css({'font-weight': 'bold', 'color': 'red'});\n                let liElement = $(this).closest('li');\n                liElement.addClass('index-element').closest('ul').before(liElement);\n            }\n        });\n        $(REGIONS.EDITTITLE).off('touchstart.dragaware mousedown.dragaware click');\n        $(REGIONS.EDITTITLE).on('touchstart.dragaware mousedown.dragaware click', function(e) {\n            e.stopPropagation();\n            let editableElement = $(this).prev('a').attr('contenteditable', 'true').focus();\n            moveCursorToEnd(editableElement[0]);\n        });\n        $(REGIONS.DELETENODE).off('touchstart.dragaware mousedown.dragaware click');\n        $(REGIONS.DELETENODE).on('touchstart.dragaware mousedown.dragaware click', function(e) {\n            e.stopPropagation();\n            currentNodeToDelete = $(this).closest('li');\n            modalDelete.show();\n        });\n        $(REGIONS.CONTENTEDITABLE).off('keydown');\n        $(REGIONS.CONTENTEDITABLE).on('keydown', function(e) {\n            hasChanges = true;\n            $(REGIONS.HASCHANGES).css('display', 'block');\n            if (e.key === \"Enter\") {\n                e.preventDefault();\n                $(this).blur();\n            }\n        });\n        $(REGIONS.CONTENTEDITABLE).off('blur, focusout');\n        $(REGIONS.CONTENTEDITABLE).on('blur, focusout', function(e) {\n            e.preventDefault();\n            e.stopPropagation();\n            if ($(this).text().trim() === '') {\n                $(this).attr('placeholder', 'El título no puede estar vacío');\n                $(this).focus();\n                $(this).css('background-color', '#ffbfaf');\n                $(this).empty();\n                moveCursorToEnd(this);\n            } else {\n                $(this).css('background-color', 'unset');\n            }\n        });\n        $(document).off('paste');\n        $(document).on('paste', '[contenteditable]', function(e) {\n            e.preventDefault();\n            let text = (e.originalEvent || e).clipboardData.getData('text/plain');\n            document.execCommand('insertText', false, text);\n        });\n        $(document).off('mousedown');\n        $(document).on('mousedown', function(e) {\n            if (e.target.id !== 'write_comment') {\n                e.preventDefault();\n                e.stopPropagation();\n                $(REGIONS.CONTENTEDITABLE).blur();\n            }\n        });\n        $(document).off('keydown');\n        $(document).on('keydown', function(event) {\n            if (event.key === 'Tab') {\n                event.preventDefault();\n                $(REGIONS.CONTENTEDITABLE).blur();\n            }\n        });\n\n        if (alreadyLoaded === false) {\n            Sortable.prototype.createModalChanges();\n            Sortable.prototype.createModalDelete();\n            document.querySelectorAll(\n                'a:not([target=\"_blank\"]), .content-controls button:not([data-action=\"save-changes\"])'\n            ).forEach(link => {\n                link.addEventListener('click', (e) => {\n                    if (hasChanges) {\n                        e.preventDefault();\n                        e.stopPropagation();\n                    }\n                    Sortable.prototype.detectChanges(e);\n                });\n            });\n            window.onbeforeunload = function(e) {\n                Sortable.prototype.detectChanges(e);\n                if (hasChanges) {\n                    e.preventDefault();\n                }\n            };\n            $(ACTION.SAVECHANGES).on('click', Sortable.prototype.saveChanges);\n            $(ACTION.ADDNODE).on('click', Sortable.prototype.addNode);\n        }\n\n        alreadyLoaded = true;\n\n        /**\n         *\n         * @param el\n         */\n        function moveCursorToEnd(el) {\n            if (typeof window.getSelection != \"undefined\"\n                && typeof document.createRange != \"undefined\") {\n                let range = document.createRange();\n                range.selectNodeContents(el);\n                range.collapse(false);\n                let sel = window.getSelection();\n                sel.removeAllRanges();\n                sel.addRange(range);\n            } else if (typeof document.body.createTextRange != \"undefined\") {\n                let textRange = document.body.createTextRange();\n                textRange.moveToElementText(el);\n                textRange.collapse(false);\n                textRange.select();\n            }\n        }\n    };\n\n    Sortable.prototype.destroy = function() {\n        let self = this;\n\n        if (self.options.make_unselectable) {\n            $('html').unselectable('destroy');\n        }\n\n        self.$sortable\n            .removeClass('sortable')\n            .off('.sortable')\n            .dragaware('destroy');\n    };\n\n    Sortable.prototype.serialize = function(container) {\n        let self = this;\n        return container.children(self.options.nodes).not(self.options.container).map(function(ix, el) {\n            let $el = $(el),\n                text = $el.clone().children().remove().end().text().trim(), // Text only without children\n                id = $el.attr('id'),\n                node = {id: id || text};\n            if ($el.find(self.options.nodes).length) {\n                node.children = self.serialize($el.children(self.options.container));\n            }\n            return node;\n        }).get();\n    };\n\n    Sortable.prototype.find_nodes = function() {\n        let self = this;\n        return self.$sortable.find(self.options.nodes).not(self.options.container);\n    };\n\n    Sortable.prototype.create_placeholder = function() {\n        let self = this;\n        return $('<' + self.options.nodes_type + '/>')\n            .addClass('sortable_placeholder')\n            .addClass(self.options.placeholder_class);\n    };\n\n    Sortable.prototype.square_dist = function(pos1, pos2) {\n        return Math.pow(pos2.left - pos1.left, 2) + Math.pow(pos2.top - pos1.top, 2);\n    };\n\n    Sortable.prototype.createModalChanges = function() {\n        Str.get_strings(hasChangesStringsKeys).then(function(langStrings) {\n            hasChangesStrings = langStrings;\n            let title = hasChangesStrings[0];\n            let confirmMessage = hasChangesStrings[1];\n            let buttonText = hasChangesStrings[2];\n            ModalFactory.create({\n                title: title,\n                body: confirmMessage,\n                type: ModalFactory.types.SAVE_CANCEL\n            }).then(function(modal) {\n                modal.setSaveButtonText(buttonText);\n                modal.getRoot().on(ModalEvents.save, function() {\n                    $(ACTION.SAVECHANGES).click();\n                    modal.hide();\n                });\n                modalChanges = modal;\n            });\n            return true;\n        });\n    };\n\n    Sortable.prototype.createModalDelete = function() {\n        Str.get_strings(deleteNode).then(function(langStrings) {\n            deleteNodeStrings = langStrings;\n            let title = deleteNodeStrings[0];\n            let confirmMessage = deleteNodeStrings[1];\n            let buttonText = deleteNodeStrings[2];\n            ModalFactory.create({\n                title: title,\n                body: confirmMessage,\n                type: ModalFactory.types.SAVE_CANCEL\n            }).then(function(modal) {\n                modal.setSaveButtonText(buttonText);\n                modal.getRoot().on(ModalEvents.save, function() {\n                    currentNodeToDelete.remove();\n                    modal.hide();\n                });\n                modalDelete = modal;\n            });\n            return true;\n        });\n    };\n\n    Sortable.prototype.detectChanges = function() {\n        if (hasChanges) {\n            modalChanges.show();\n        }\n    };\n\n    Sortable.prototype.saveChanges = function(e) {\n        e.preventDefault();\n        e.stopPropagation();\n        let courseid = $(e.currentTarget).attr('data-courseid');\n        let resourceid = $(e.currentTarget).attr('data-resourceid');\n        let versionname = $(e.currentTarget).attr('data-versionname');\n        let stringkeys = [\n            {key: 'save_changes', component: 'local_educaaragon'},\n            {key: 'save_changes_desc', component: 'local_educaaragon'},\n            {key: 'confirm', component: 'local_educaaragon'},\n            {key: 'changes_saved', component: 'local_educaaragon'},\n            {key: 'not_saved', component: 'local_educaaragon'},\n            {key: 'write_comment', component: 'local_educaaragon'}\n        ];\n        Str.get_strings(stringkeys).then(function(langStrings) {\n            let title = langStrings[0];\n            let confirmMessage = langStrings[1];\n            let buttonText = langStrings[2];\n            let htmlForBody = '<p>' + confirmMessage + '</p>' +\n                '<div class=\"col-xl-12\">' +\n                '<div class=\"form-group purple-border mb-5\">' +\n                '<label for=\"write_comment\" class=\"\">' + langStrings[5] + '</label>' +\n                '<textarea maxlength=\"300\" class=\"form-control\" id=\"write_comment\" rows=\"3\"></textarea>' +\n                '</div>' +\n                '</div>';\n\n            let liElement = $('.index-element');\n            liElement.removeClass('index-element').prependTo($('.toc-list-content').find('ul').first());\n            let htmlContent = $('.toc-list-content ul:first-child').html();\n            let html = $.parseHTML(htmlContent);\n            $(html).find(REGIONS.EDITTITLE).each(function() {\n                $(this).remove();\n            });\n            $(html).find(REGIONS.DELETENODE).each(function() {\n                $(this).remove();\n            });\n            $(html).find(REGIONS.CONTENTEDITABLE).each(function() {\n                $(this).removeAttr('contenteditable style').unwrap();\n            });\n            $(html).find('.sortable_container').each(function() {\n                $(this).removeAttr('class');\n            });\n            $(html).each(function() {\n                $(this).removeAttr('id style');\n                $(this).find('ul').each(function() {\n                    if ($(this).has('li').length === 0) {\n                        $(this).remove();\n                    }\n                });\n                $(this).find('li').each(function() {\n                    $(this).removeAttr('id style');\n                });\n            });\n            let cleanedHtml = $('<div>').append(html).html();\n            liElement.addClass('index-element').insertBefore(liElement.closest('ul'));\n            return ModalFactory.create({\n                title: title,\n                body: htmlForBody,\n                type: ModalFactory.types.SAVE_CANCEL\n            }).then(function(modal) {\n                modal.setSaveButtonText(buttonText);\n                modal.getRoot().on(ModalEvents.save, function(e) {\n                    e.preventDefault();\n                    let comment = $('#write_comment').val();\n                    if (comment.length > 300) {\n                        comment = comment.substring(0, 300);\n                    }\n                    modal.hide();\n                    let request = {\n                        methodname: SERVICES.SAVECHANGES,\n                        args: {\n                            courseid: courseid,\n                            resourceid: resourceid,\n                            versionname: versionname,\n                            html: cleanedHtml,\n                            other: btoa(comment)\n                        }\n                    };\n                    Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n                        let identifier = $('body');\n                        identifier.append(html);\n                        Ajax.call([request])[0].done(function(response) {\n                            const d = new Date();\n                            if (response.response === true) {\n                                Templates.render(TEMPLATES.SUCCESS, {message: langStrings[3] + d.toTimeString().split(' ')[0],\n                                    closebutton: true,\n                                    // eslint-disable-next-line max-nested-callbacks\n                                    announce: true}).done(function(htmlsuccess) {\n                                    $(REGIONS.CONTENT_CONTROLS).prepend(htmlsuccess);\n                                });\n                                hasChanges = false;\n                                $(REGIONS.NEWNODE).removeAttr('class');\n                                $(REGIONS.HASCHANGES).css('display', 'none');\n                                if (response.tochtml) {\n                                    $(REGIONS.TOCLISTCONTENT).html(response.tochtml);\n                                    $(function() {\n                                        $('.toc-list-content ul:first-child').sortable({\n                                            autocreate: true,\n                                            update: function(evt) {\n                                                hasChanges = true;\n                                                $('.haschanges').css('display', 'block');\n                                            }\n                                        });\n                                    });\n                                }\n                            } else {\n                                Templates.render(TEMPLATES.ERROR, {message: langStrings[4],\n                                    closebutton: true,\n                                    announce: true}).done(function(htmlerror) {\n                                    $(REGIONS.CONTENT_CONTROLS).prepend(htmlerror);\n                                });\n                            }\n                            $(REGIONS.OVERLAY).remove();\n                        }).fail(Notification.exception);\n                    });\n                });\n                modal.getRoot().on(ModalEvents.hidden, function() {\n                    modal.destroy();\n                });\n                return modal;\n            });\n        }).done(function(modal) {\n            modal.show();\n            $('#write_comment').focus();\n        }).fail(Notification.exception);\n    };\n\n    Sortable.prototype.addNode = function(e) {\n        let htmlLi = '<li class=\"new-node\">' +\n            '<div class=\"content-title d-flex flex-nowrap align-items-center justify-content-start\">' +\n            '<a href=\"\" class=\"no-ch\" contenteditable=\"true\">Nuevo Elemento</a>' +\n            '<i class=\"edit-title icon fa fa-pencil fa-fw float-right ml-6\" ' +\n            'title=\"Edit Title\" role=\"img\" aria-label=\"Edit Title\"></i>' +\n            '<i class=\"delete-node icon fa fa-trash fa-fw float-right ml-6\" ' +\n            'title=\"Delete Node\" role=\"img\" aria-label=\"Delete Node\"></i>' +\n            '</div></li>';\n        if ($(e.currentTarget).hasClass('forprev')) {\n            let targetLi = $(REGIONS.DRAGGING).find('a[href=\"index.html\"]').closest('li');\n            if (targetLi.length) {\n                $(htmlLi).insertAfter(targetLi);\n            } else {\n                $(REGIONS.DRAGGING).prepend(htmlLi);\n            }\n        } else {\n            $(REGIONS.DRAGGING).append(htmlLi);\n        }\n        hasChanges = true;\n        $('.haschanges').css('display', 'block');\n        $(REGIONS.NEWNODEEDIT).off('touchstart.dragaware mousedown.dragaware click');\n        $(REGIONS.NEWNODEDELETE).off('touchstart.dragaware mousedown.dragaware click');\n        $(REGIONS.NEWNODECONTENTEDITABLE).off('keydown');\n        $(REGIONS.NEWNODECONTENTEDITABLE).off('blur, focusout');\n        $(REGIONS.NEWNODEEDIT).on('touchstart.dragaware mousedown.dragaware click', function(e) {\n            e.stopPropagation();\n            let editableElement = $(this).prev('a').attr('contenteditable', 'true').focus();\n            if (typeof window.getSelection != \"undefined\"\n                && typeof document.createRange != \"undefined\") {\n                let range = document.createRange();\n                range.selectNodeContents(editableElement[0]);\n                range.collapse(false);\n                let sel = window.getSelection();\n                sel.removeAllRanges();\n                sel.addRange(range);\n            } else if (typeof document.body.createTextRange != \"undefined\") {\n                let textRange = document.body.createTextRange();\n                textRange.moveToElementText(editableElement[0]);\n                textRange.collapse(false);\n                textRange.select();\n            }\n        });\n        $(REGIONS.NEWNODEDELETE).on('touchstart.dragaware mousedown.dragaware click', function(e) {\n            e.stopPropagation();\n            currentNodeToDelete = $(this).closest('li');\n            modalDelete.show();\n        });\n        $(REGIONS.NEWNODECONTENTEDITABLE).on('keydown', function(e) {\n            hasChanges = true;\n            $(REGIONS.HASCHANGES).css('display', 'block');\n            if (e.key === \"Enter\") {\n                e.preventDefault();\n                $(this).blur();\n            }\n        });\n        $(REGIONS.NEWNODECONTENTEDITABLE).on('blur, focusout', function(e) {\n            e.preventDefault();\n            e.stopPropagation();\n            if ($(this).text().trim() === '') {\n                $(this).attr('placeholder', 'El título no puede estar vacío');\n                $(this).focus();\n                $(this).css('background-color', '#ffbfaf');\n                $(this).empty();\n                if (typeof window.getSelection != \"undefined\"\n                    && typeof document.createRange != \"undefined\") {\n                    let range = document.createRange();\n                    range.selectNodeContents(this);\n                    range.collapse(false);\n                    let sel = window.getSelection();\n                    sel.removeAllRanges();\n                    sel.addRange(range);\n                } else if (typeof document.body.createTextRange != \"undefined\") {\n                    let textRange = document.body.createTextRange();\n                    textRange.moveToElementText(this);\n                    textRange.collapse(false);\n                    textRange.select();\n                }\n            } else {\n                $(this).css('background-color', 'unset');\n            }\n        });\n        if ($(e.currentTarget).hasClass('forprev')) {\n            $(REGIONS.NEWNODEEDIT).first().click();\n        } else {\n            $(REGIONS.NEWNODEEDIT).last().click();\n        }\n    };\n\n\n    /**\n     *\n     * @param el\n     * @param options\n     */\n    function Draggable(el, options) {\n        let self = this,\n            defaults = {\n                handle: false,\n                delegate: false,\n                revert: false,\n                placeholder: false,\n                droptarget: false,\n                container: false,\n                scroll: false,\n                update: null,\n                drop: null\n            };\n\n        self.$draggable = $(el).data('draggable', self);\n        self.options = $.extend({}, defaults, options);\n\n        self.init();\n    }\n\n    Draggable.prototype.init = function() {\n        let self = this,\n            $clone,\n            origin;\n\n        self.$draggable\n            .addClass('draggable')\n            .on('destroy.draggable', function() {\n                self.destroy();\n            });\n\n        /**\n         *\n         * @param pos\n         */\n        function check_droptarget(pos) {\n            let $over;\n\n            $('.hovering').removeClass('hovering');\n\n            $clone.hide();\n            $over = $(document.elementFromPoint(pos.clientX, pos.clientY)).closest(self.options.droptarget);\n            $clone.show();\n\n            if ($over.length) {\n                $over.addClass('hovering');\n                return $over;\n            }\n        }\n\n        self.$draggable.dragaware($.extend({}, self.options, {\n            /**\n             * Drag start - create clone, keep drag start origin.\n             */\n            dragstart: function() {\n                let $this = $(this);\n                if (self.options.placeholder || self.options.revert) {\n                    $clone = $this.clone()\n                        .removeAttr('id')\n                        .addClass('draggable_clone')\n                        .css({position: 'absolute'})\n                        .appendTo(self.options.container || $this.parent())\n                        .offset($this.offset());\n                    if (!self.options.placeholder) {\n                        $(this).invisible();\n                    }\n                } else {\n                    $clone = $this;\n                }\n\n                origin = new PositionHelper($clone.offset());\n            },\n\n            /**\n             * Drag - reposition clone.\n             * @param evt\n             * @param pos\n             */\n            drag: function(evt, pos) {\n                // eslint-disable-next-line no-unused-vars\n                let $droptarget = check_droptarget(pos);\n                $clone.offset(origin.absolutize(pos));\n            },\n\n            /**\n             * Drag stop - clean up.\n             * @param evt\n             * @param pos\n             */\n            dragstop: function(evt, pos) {\n                let $this = $(this),\n                    $droptarget = check_droptarget(pos);\n\n                if (self.options.revert || self.options.placeholder) {\n                    $this.visible();\n                    if (!self.options.revert) {\n                        $this.offset(origin.absolutize(pos));\n                    }\n                    $clone.remove();\n                }\n\n                $clone = null;\n\n                if (self.options.update) {\n                    hasChanges = true;\n                    self.options.update.call($this, evt, self);\n                }\n\n                $this.trigger('update');\n\n                if ($droptarget) {\n                    if (self.options.drop) {\n                        self.options.drop.call($this, evt, $droptarget[0]);\n                    }\n                    $droptarget.trigger('drop', [$this]);\n                    $droptarget.removeClass('hovering');\n                } else {\n                    if (self.options.onrevert) {\n                        self.options.onrevert.call($this, evt);\n                    }\n                }\n            }\n        }));\n    };\n\n    Draggable.prototype.destroy = function() {\n        let self = this;\n\n        self.$draggable\n            .dragaware('destroy')\n            .removeClass('draggable')\n            .off('.draggable');\n    };\n\n\n    /**\n     *\n     * @param el\n     * @param options\n     */\n    function Droppable(el, options) {\n        let self = this,\n            defaults = {\n                accept: false,\n                drop: null\n            };\n\n        self.$droppable = $(el).data('droppable', self);\n        self.options = $.extend({}, defaults, options);\n\n        self.init();\n    }\n\n    Droppable.prototype.init = function() {\n        let self = this;\n\n        self.$droppable\n            .addClass('droppable')\n            .on('drop', function(evt, $draggable) {\n                if (self.options.accept && !$draggable.is(self.options.accept)) {\n                    return;\n                }\n                if (self.options.drop) {\n                    self.options.drop.call(self.$droppable, evt, $draggable);\n                }\n            })\n            .on('destroy.droppable', function() {\n                self.destroy();\n            });\n    };\n\n    Droppable.prototype.destroy = function() {\n        let self = this;\n\n        self.$droppable\n            .removeClass('droppable')\n            .off('.droppable');\n    };\n\n\n    /**\n     *\n     * @param el\n     * @param options\n     */\n    function Dragaware(el, options) {\n        let $dragaware = $(el),\n            $reference = null,\n            origin = null,\n            lastpos = null,\n            defaults = {\n                handle: null,\n                delegate: null,\n                scroll: false,\n                scrollspeed: 15,\n                scrolltimeout: 50,\n                dragstart: null,\n                drag: null,\n                dragstop: null\n            },\n            scrolltimeout;\n\n        options = $.extend({}, defaults, options);\n\n        /**\n         * Returns the event position\n         * dX, dY relative to drag start\n         * pageX, pageY relative to document\n         * clientX, clientY relative to browser window\n         * @param evt\n         */\n        function evtpos(evt) {\n            evt = window.hasOwnProperty('event') ? window.event : evt;\n            // Extract touch event if present\n            if (evt.type.substring(0, 5) === 'touch') {\n                evt = evt.hasOwnProperty('originalEvent') ? evt.originalEvent : evt;\n                evt = evt.touches[0];\n            }\n\n            return {\n                pageX: evt.pageX,\n                pageY: evt.pageY,\n                clientX: evt.clientX,\n                clientY: evt.clientY,\n                dX: origin ? evt.pageX - origin.pageX : 0,\n                dY: origin ? evt.pageY - origin.pageY : 0\n            };\n        }\n\n        /**\n         *\n         * @param pos\n         */\n        function autoscroll(pos) {\n            // TODO: allow window scrolling.\n            // TODO: handle nested scroll containers.\n            let sp = $dragaware.scrollParent(),\n                mouse = {x: pos.pageX, y: pos.pageY},\n                offset = sp.offset(),\n                scrollLeft = sp.scrollLeft(),\n                scrollTop = sp.scrollTop(),\n                width = sp.width(),\n                height = sp.height();\n\n            window.clearTimeout(scrolltimeout);\n\n            if (scrollLeft > 0 && mouse.x < offset.left) {\n                sp.scrollLeft(scrollLeft - options.scrollspeed);\n            } else if (scrollLeft < sp.prop('scrollWidth') - width && mouse.x > offset.left + width) {\n                sp.scrollLeft(scrollLeft + options.scrollspeed);\n            } else if (scrollTop > 0 && mouse.y < offset.top) {\n                sp.scrollTop(scrollTop - options.scrollspeed);\n            } else if (scrollTop < sp.prop('scrollHeight') - height && mouse.y > offset.top + height) {\n                sp.scrollTop(scrollTop + options.scrollspeed);\n            } else {\n                return;\n            }\n\n            scrolltimeout = window.setTimeout(function() {\n                autoscroll(pos);\n            }, options.scrolltimeout);\n        }\n\n        /**\n         *\n         * @param evt\n         */\n        function start(evt) {\n            let $target = $(evt.target);\n\n            $reference = options.delegate ? $target.closest(options.delegate) : $dragaware;\n\n            if ($target.closest(options.handle || '*').length && (evt.type == 'touchstart' || evt.button == 0)) {\n                origin = lastpos = evtpos(evt);\n                if (options.dragstart) {\n                    options.dragstart.call($reference, evt, lastpos);\n                }\n\n                $reference.addClass('dragging');\n                $reference.trigger('dragstart');\n\n                // Late binding of event listeners\n                $(document)\n                    .on('touchend.dragaware mouseup.dragaware click.dragaware', end)\n                    .on('touchmove.dragaware mousemove.dragaware', move);\n                return false;\n            }\n        }\n\n        /**\n         *\n         * @param evt\n         */\n        function move(evt) {\n            lastpos = evtpos(evt);\n            $(REGIONS.CONTENTEDITABLE).blur();\n            if (options.scroll) {\n                autoscroll(lastpos);\n            }\n\n            $reference.trigger('dragging');\n\n            if (options.drag) {\n                options.drag.call($reference, evt, lastpos);\n                return false;\n            }\n        }\n\n        /**\n         *\n         * @param evt\n         */\n        function end(evt) {\n            $(REGIONS.CONTENTEDITABLE).blur();\n            window.clearTimeout(scrolltimeout);\n\n            if (options.dragstop) {\n                options.dragstop.call($reference, evt, lastpos);\n            }\n\n            $reference.removeClass('dragging');\n            $reference.trigger('dragstop');\n\n            origin = false;\n            lastpos = false;\n            $reference = false;\n\n            $(document)\n                .off('.dragaware');\n\n            return false;\n        }\n\n        $dragaware\n            .addClass('dragaware')\n            .on('touchstart.dragaware mousedown.dragaware', options.delegate, start);\n\n        $dragaware.on('destroy.dragaware', function() {\n            $dragaware\n                .removeClass('dragaware')\n                .off('.dragaware');\n        });\n    }\n\n\n    /**\n     *\n     * @param origin\n     */\n    function PositionHelper(origin) {\n        this.origin = origin;\n    }\n    PositionHelper.prototype.absolutize = function(pos) {\n        if (!pos) {\n            return this.origin;\n        }\n        return {top: this.origin.top + pos.dY, left: this.origin.left + pos.dX};\n    };\n\n\n    /**\n     * Sortable plugin.\n     * @param options\n     */\n    $.fn.sortable = function(options) {\n        let filtered = this.not(function() {\n            return $(this).is('.sortable') || $(this).closest('.sortable').length;\n        });\n\n        if (this.data('sortable') && typeof options === 'string') {\n            return this.data('sortable').invoke(options);\n        }\n\n        if (filtered.length && options && options.group) {\n            new Sortable(filtered, options);\n        } else {\n            filtered.each(function(ix, el) {\n                new Sortable(el, options);\n            });\n        }\n        return this;\n    };\n\n\n    /**\n     * Draggable plugin.\n     * @param options\n     */\n    $.fn.draggable = function(options) {\n        if (options === 'destroy') {\n            this.trigger('destroy.draggable');\n        } else {\n            this.not('.draggable').each(function(ix, el) {\n                new Draggable(el, options);\n            });\n        }\n        return this;\n    };\n\n\n    /**\n     * Droppable plugin.\n     * @param options\n     */\n    $.fn.droppable = function(options) {\n        if (options === 'destroy') {\n            this.trigger('destroy.droppable');\n        } else {\n            this.not('.droppable').each(function(ix, el) {\n                new Droppable(el, options);\n            });\n        }\n        return this;\n    };\n\n\n    /**\n     * Dragaware plugin.\n     * @param options\n     */\n    $.fn.dragaware = function(options) {\n        if (options === 'destroy') {\n            this.trigger('destroy.dragaware');\n        } else {\n            this.not('.dragaware').each(function(ix, el) {\n                new Dragaware(el, options);\n            });\n        }\n        return this;\n    };\n\n\n    /**\n     * Disables mouse selection.\n     * @param command\n     */\n    $.fn.unselectable = function(command) {\n\n        /**\n         *\n         */\n        function disable() {\n            return false;\n        }\n\n        if (command === 'destroy') {\n            return this\n                .removeClass('unselectable')\n                .removeAttr('unselectable')\n                .off('selectstart.unselectable');\n        } else {\n            return this\n                .addClass('unselectable')\n                .attr('unselectable', 'on')\n                .on('selectstart.unselectable', disable);\n        }\n    };\n\n\n    $.fn.invisible = function() {\n        return this.css({visibility: 'hidden'});\n    };\n\n\n    $.fn.visible = function() {\n        return this.css({visibility: 'visible'});\n    };\n\n\n    $.fn.scrollParent = function() {\n        return this.parents().addBack().filter(function() {\n            let p = $(this);\n            return (/(scroll|auto)/).test(p.css(\"overflow-x\") + p.css(\"overflow-y\") + p.css(\"overflow\"));\n        });\n    };\n\n    $.fn.nestingDepth = function(selector) {\n        let parent = this.parent().closest(selector || '*');\n        if (parent.length) {\n            return parent.nestingDepth(selector) + 1;\n        } else {\n            return 0;\n        }\n    };\n\n});\n"],"names":["define","$","Str","Ajax","ModalFactory","ModalEvents","Templates","Notification","ACTION","SERVICES","REGIONS","TEMPLATES","Sortable","el","options","$sortable","container_type","nodeName","node_type","defaults","handle","container","same_depth","make_unselectable","nodes","nodes_type","placeholder_class","auto_container_class","autocreate","group","scroll","update","this","data","extend","init","prototype","invoke","command","self","destroy","serialize","hasChangesStrings","deleteNodeStrings","modalChanges","modalDelete","currentNodeToDelete","hasChanges","hasChangesStringsKeys","key","component","deleteNode","alreadyLoaded","Draggable","$draggable","delegate","revert","placeholder","droptarget","drop","Droppable","$droppable","accept","Dragaware","scrolltimeout","$dragaware","$reference","origin","lastpos","evtpos","evt","window","hasOwnProperty","event","type","substring","originalEvent","touches","pageX","pageY","clientX","clientY","dX","dY","autoscroll","pos","sp","scrollParent","mouse","offset","scrollLeft","scrollTop","width","height","clearTimeout","left","scrollspeed","prop","top","setTimeout","move","blur","trigger","drag","call","end","dragstop","removeClass","document","off","dragstart","addClass","on","$target","target","closest","length","button","PositionHelper","$clone","$placeholder","find_insert_point","$node","containers","best","depth","add","find","not","find_nodes","parent","nestingDepth","filter","hide","each","ix","$candidate","n","dist","$trailing","create_placeholder","appendTo","$children","children","eq","square_dist","before","remove","show","insert","$element","$container","insertBefore","moveCursorToEnd","getSelection","createRange","range","selectNodeContents","collapse","sel","removeAllRanges","addRange","body","createTextRange","textRange","moveToElementText","select","unselectable","dragaware","clone","removeAttr","css","position","insertAfter","outerHeight","outerWidth","append","absolutize","wrap","attr","after","liElement","e","stopPropagation","prev","focus","preventDefault","text","trim","empty","clipboardData","getData","execCommand","id","createModalChanges","createModalDelete","querySelectorAll","forEach","link","addEventListener","detectChanges","onbeforeunload","saveChanges","addNode","map","$el","node","get","pos1","pos2","Math","pow","get_strings","then","langStrings","title","confirmMessage","buttonText","create","types","SAVE_CANCEL","modal","setSaveButtonText","getRoot","save","click","courseid","currentTarget","resourceid","versionname","htmlForBody","prependTo","first","htmlContent","html","parseHTML","unwrap","has","cleanedHtml","comment","val","request","methodname","args","other","btoa","render","visible","done","response","d","Date","message","toTimeString","split","closebutton","announce","htmlsuccess","prepend","tochtml","sortable","htmlerror","fail","exception","hidden","htmlLi","hasClass","targetLi","editableElement","last","check_droptarget","$over","elementFromPoint","$this","invisible","$droptarget","onrevert","is","fn","filtered","draggable","droppable","visibility","parents","addBack","p","test","selector"],"mappings":"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"}