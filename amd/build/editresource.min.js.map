{"version":3,"file":"editresource.min.js","sources":["../src/editresource.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @author 3iPunt <https://www.tresipunt.com/>\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @copyright 3iPunt <https://www.tresipunt.com/>\n */\n\ndefine([\n    'jquery',\n    'core/str',\n    'core/ajax',\n    'core/modal_factory',\n    'core/modal_events',\n    'core/templates',\n    'core/notification'\n], function($, Str, Ajax, ModalFactory, ModalEvents, Templates, Notification) {\n    \"use strict\";\n    /* eslint-disable no-console */\n    let ACTION = {\n        CREATEVERSION: '[data-action=\"createversion\"]',\n        DELETEVERSION: '[data-action=\"deleteversion\"]',\n        LOADVERSION: '[data-action=\"loadversion\"]',\n        EDITTOC: '[data-action=\"edittoc\"]',\n        SAVECHANGES: '[data-action=\"save-changes\"]',\n        APPLYVERSION: '[data-action=\"apply-version\"]',\n        CHANGEVERSION: '[data-action=\"change-version\"]',\n        PROCESSVERSIONLINKS: '[data-action=\"process-version-links\"]',\n        VIEWVERSIONLINKS: '[data-action=\"viewversionlinks\"]',\n        VIEWVERSIONLINKSEDIT: '[data-action=\"viewversionlinks_link\"]'\n    };\n\n    let SERVICES = {\n        CREATEVERSION: 'local_educaaragon_createversion',\n        DELETEVERSION: 'local_educaaragon_deleteversion',\n        SAVECHANGES: 'local_educaaragon_savechanges',\n        APPLYVERSION: 'local_educaaragon_applyversion',\n        PROCESSVERSIONLINKS: 'local_educaaragon_processresourcelinks'\n    };\n\n    let REGION = {\n        CONTENT_CONTROLS: '[data-region=\"educaaragon-editresource\"]',\n        CONTENT_ATTO_HTML: '.editor_atto_content',\n        OVERLAY: '[data-region=\"overlay-icon-container\"]',\n        HASCHANGES: '.haschanges'\n    };\n\n    let TEMPLATES = {\n        LOADING: 'core/overlay_loading',\n        SUCCESS: 'core/notification_success',\n        ERROR: 'core/notification_error'\n    };\n\n    /**\n     * @constructor\n     * @param {String} selector The selector for the page region containing the page.\n     */\n    function EditResource(selector) {\n        this.node = $(selector);\n        this.initEditResource();\n    }\n\n    let hasChanges = false;\n    let hasChangesStringsKeys = [\n        {key: 'changesnotsaved', component: 'local_educaaragon'},\n        {key: 'changesnotsaved_desc', component: 'local_educaaragon'},\n        {key: 'savechanges', component: 'local_educaaragon'}\n    ];\n    let hasChangesStrings;\n    let modalChanges;\n\n    /** @type {jQuery} The jQuery node for the page region. */\n    EditResource.prototype.node = null;\n\n    EditResource.prototype.initEditResource = function() {\n        this.node.find(ACTION.CREATEVERSION).on('click', this.createVersion);\n        this.node.find(ACTION.DELETEVERSION).on('click', this.deleteVersion);\n        this.node.find(ACTION.LOADVERSION).on('click', this.loadVersion);\n        this.node.find(ACTION.EDITTOC).on('click', this.editToc);\n        this.node.find(ACTION.SAVECHANGES).on('click', this.saveChanges);\n        this.node.find(ACTION.APPLYVERSION).on('click', this.applyVersion);\n        this.node.find(ACTION.PROCESSVERSIONLINKS).on('click', this.processVersionLinks);\n        this.node.find(ACTION.VIEWVERSIONLINKS).on('click', this.viewVersionLinks);\n        this.changeVersion();\n        $(document).on('change', ACTION.CHANGEVERSION, this.changeVersion);\n        this.createModalChanges();\n        document.querySelector(REGION.CONTENT_ATTO_HTML).addEventListener('input', function() {\n            hasChanges = true;\n            $(REGION.HASCHANGES).css('display', 'block');\n        });\n        $('.editor_atto_toolbar [type=\"button\"]:not(.atto_collapse_button)').on('click', function(){\n            hasChanges = true;\n            $(REGION.HASCHANGES).css('display', 'block');\n        });\n        document.querySelectorAll(\n            'a:not([target=\"_blank\"]), .content-controls button:not([data-action=\"save-changes\"])'\n        ).forEach(link => {\n            link.addEventListener('click', (e) => {\n                if (hasChanges) {\n                    e.preventDefault();\n                    e.stopPropagation();\n                }\n                EditResource.prototype.detectChanges(e);\n            });\n        });\n\n        window.onbeforeunload = function(e) {\n            EditResource.prototype.detectChanges(e);\n            if (hasChanges) {\n                e.preventDefault();\n            }\n        };\n    };\n\n    EditResource.prototype.createVersion = function(e) {\n        e.preventDefault();\n        e.stopPropagation();\n        let courseid = $(e.currentTarget).attr('data-courseid');\n        let resourceid = $(e.currentTarget).attr('data-resourceid');\n        let versionname = $('#newversion').val();\n        let asofversion = $('[data-region=\"select-asofversion\"]').val();\n        if (asofversion === undefined) {\n            asofversion = 'original';\n        }\n        let stringkeys = [\n            {key: 'createnewversion', component: 'local_educaaragon'},\n            {key: 'createnewversion_desc', component: 'local_educaaragon'},\n            {key: 'confirm', component: 'local_educaaragon'},\n            {key: 'errorcreateversion', component: 'local_educaaragon'}\n        ];\n        Str.get_strings(stringkeys).then(function(langStrings) {\n            let title = langStrings[0];\n            let confirmMessage = langStrings[1];\n            let buttonText = langStrings[2];\n            let error = langStrings[3];\n            return ModalFactory.create({\n                title: title,\n                body: confirmMessage,\n                type: ModalFactory.types.SAVE_CANCEL\n            }).then(function(modal) {\n                modal.setSaveButtonText(buttonText);\n                modal.getRoot().on(ModalEvents.save, function() {\n                    let request = {\n                        methodname: SERVICES.CREATEVERSION,\n                        args: {\n                            courseid: courseid,\n                            resourceid: resourceid,\n                            versionname: versionname,\n                            asofversion: asofversion,\n                        }\n                    };\n                    Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n                        let identifier = $('body');\n                        identifier.append(html);\n                        Ajax.call([request])[0].done(function(response) {\n                            if (response.response === true) {\n                                let url = window.location.href;\n                                if (url.indexOf('?') > -1) {\n                                    url += '&version=' + response.versionname;\n                                } else {\n                                    url += '?version=' + response.versionname;\n                                }\n                                window.location.href = url;\n                            }\n                            if (response.response === false) {\n                                identifier.html('<div class=\"alert alert-danger\">' + error + '</div>');\n                            }\n                        }).fail(Notification.exception);\n                    });\n                });\n                modal.getRoot().on(ModalEvents.hidden, function() {\n                    modal.destroy();\n                });\n                return modal;\n            });\n        }).done(function(modal) {\n            modal.show();\n        }).fail(Notification.exception);\n    };\n\n    EditResource.prototype.deleteVersion = function(e) {\n        e.preventDefault();\n        e.stopPropagation();\n        let courseid = $(e.currentTarget).attr('data-courseid');\n        let resourceid = $(e.currentTarget).attr('data-resourceid');\n        let versionname = $('[data-region=\"select-version\"]').val();\n        let stringkeys = [\n            {key: 'changesnotsaved', component: 'local_educaaragon'},\n            {key: 'changesnotsaved_desc', component: 'local_educaaragon'},\n            {key: 'confirm', component: 'local_educaaragon'}\n        ];\n        Str.get_strings(stringkeys).then(function(langStrings) {\n            let title = langStrings[0];\n            let confirmMessage = langStrings[1];\n            let buttonText = langStrings[2];\n            return ModalFactory.create({\n                title: title,\n                body: confirmMessage,\n                type: ModalFactory.types.SAVE_CANCEL\n            }).then(function(modal) {\n                modal.setSaveButtonText(buttonText);\n                modal.getRoot().on(ModalEvents.save, function() {\n                    let request = {\n                        methodname: SERVICES.DELETEVERSION,\n                        args: {\n                            courseid: courseid,\n                            resourceid: resourceid,\n                            versionname: versionname\n                        }\n                    };\n                    Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n                        let identifier = $('body');\n                        identifier.append(html);\n                        Ajax.call([request])[0].done(function(response) {\n                            if (response.response === true) {\n                                location.reload();\n                            }\n                        }).fail(Notification.exception);\n                    });\n                });\n                modal.getRoot().on(ModalEvents.hidden, function() {\n                    modal.destroy();\n                });\n                return modal;\n            });\n        }).done(function(modal) {\n            modal.show();\n        }).fail(Notification.exception);\n    };\n\n    EditResource.prototype.loadVersion = function(e) {\n        e.preventDefault();\n        e.stopPropagation();\n        let versionname = $('[data-region=\"select-version\"]').val();\n        let url = window.location.href;\n        if (url.indexOf('?') > -1) {\n            url += '&version=' + versionname;\n        } else {\n            url += '?version=' + versionname;\n        }\n        window.location.href = url;\n    };\n\n    EditResource.prototype.editToc = function(e) {\n        e.preventDefault();\n        e.stopPropagation();\n        let versionname = $('[data-region=\"select-version\"]').val();\n        let url = window.location.href;\n        url = url.replace('editresource.php', 'editresourcetoc.php');\n        if (url.indexOf('?') > -1) {\n            url += '&version=' + versionname;\n        } else {\n            url += '?version=' + versionname;\n        }\n        window.location.href = url;\n    };\n\n    EditResource.prototype.saveChanges = function(e) {\n        e.preventDefault();\n        e.stopPropagation();\n        let courseid = $(e.currentTarget).attr('data-courseid');\n        let resourceid = $(e.currentTarget).attr('data-resourceid');\n        let versionname = $(e.currentTarget).attr('data-versionname');\n        let filename = $(e.currentTarget).attr('data-filename');\n        let html = $(REGION.CONTENT_ATTO_HTML).html();\n        let stringkeys = [\n            {key: 'save_changes', component: 'local_educaaragon'},\n            {key: 'save_changes_desc', component: 'local_educaaragon'},\n            {key: 'confirm', component: 'local_educaaragon'},\n            {key: 'changes_saved', component: 'local_educaaragon'},\n            {key: 'not_saved', component: 'local_educaaragon'},\n            {key: 'write_comment', component: 'local_educaaragon'}\n        ];\n        Str.get_strings(stringkeys).then(function(langStrings) {\n            let title = langStrings[0];\n            let confirmMessage = langStrings[1];\n            let buttonText = langStrings[2];\n            let htmlForBody = '<p>' + confirmMessage + '</p>' +\n                '<div class=\"col-xl-12\">' +\n                '<div class=\"form-group purple-border mb-5\">' +\n                '<label for=\"write_comment\" class=\"\">' + langStrings[5] + '</label>' +\n                '<textarea maxlength=\"300\" class=\"form-control\" id=\"write_comment\" rows=\"3\"></textarea>' +\n                '</div>' +\n                '</div>';\n            return ModalFactory.create({\n                title: title,\n                body: htmlForBody,\n                type: ModalFactory.types.SAVE_CANCEL\n            }).then(function(modal) {\n                modal.setSaveButtonText(buttonText);\n                modal.getRoot().on(ModalEvents.save, function(e) {\n                    e.preventDefault();\n                    let comment = $('#write_comment').val();\n                    if (comment.length > 300) {\n                        comment = comment.substring(0, 300);\n                    }\n                    modal.hide();\n                    let request = {\n                        methodname: SERVICES.SAVECHANGES,\n                        args: {\n                            courseid: courseid,\n                            resourceid: resourceid,\n                            versionname: versionname,\n                            filename: filename,\n                            html: html,\n                            other: btoa(comment)\n                        }\n                    };\n                    Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n                        let identifier = $('body');\n                        identifier.append(html);\n                        Ajax.call([request])[0].done(function(response) {\n                            const d = new Date();\n                            if (response.response === true) {\n                                Templates.render(TEMPLATES.SUCCESS, {message: langStrings[3] + d.toTimeString().split(' ')[0],\n                                    closebutton: true,\n                                    // eslint-disable-next-line max-nested-callbacks\n                                    announce: true}).done(function(htmlsuccess) {\n                                    $(REGION.CONTENT_CONTROLS).prepend(htmlsuccess);\n                                });\n                                hasChanges = false;\n                                $(REGION.HASCHANGES).css('display', 'none');\n                            } else {\n                                Templates.render(TEMPLATES.ERROR, {message: langStrings[4],\n                                    closebutton: true,\n                                    // eslint-disable-next-line max-nested-callbacks\n                                    announce: true}).done(function(htmlerror) {\n                                    $(REGION.CONTENT_CONTROLS).prepend(htmlerror);\n                                });\n                            }\n                            $(REGION.OVERLAY).remove();\n                        }).fail(Notification.exception);\n                    });\n                });\n                modal.getRoot().on(ModalEvents.hidden, function() {\n                    modal.destroy();\n                });\n                return modal;\n            });\n        }).done(function(modal) {\n            modal.show();\n        }).fail(Notification.exception);\n    };\n\n    EditResource.prototype.applyVersion = function(e) {\n        e.preventDefault();\n        e.stopPropagation();\n        if (hasChanges) {\n            EditResource.prototype.detectChanges(e);\n        } else {\n            let courseid = $(e.currentTarget).attr('data-courseid');\n            let resourceid = $(e.currentTarget).attr('data-resourceid');\n            let versionname = $(e.currentTarget).attr('data-versionname');\n            if (versionname === undefined) {\n                versionname = $('[data-region=\"select-version\"]').val();\n            }\n            let stringkeys = [\n                {key: 'apply_version', component: 'local_educaaragon'},\n                {key: 'apply_version_desc', component: 'local_educaaragon'},\n                {key: 'confirm', component: 'local_educaaragon'},\n                {key: 'version_saved', component: 'local_educaaragon'},\n                {key: 'version_not_saved', component: 'local_educaaragon'},\n                {key: 'versionprintable_saved', component: 'local_educaaragon'},\n                {key: 'versionprintable_not_saved', component: 'local_educaaragon'}\n            ];\n\n            Str.get_strings(stringkeys).then(function(langStrings) {\n                let title = langStrings[0];\n                let confirmMessage = langStrings[1];\n                let buttonText = langStrings[2];\n                return ModalFactory.create({\n                    title: title,\n                    body: confirmMessage,\n                    type: ModalFactory.types.SAVE_CANCEL\n                }).then(function(modal) {\n                    modal.setSaveButtonText(buttonText);\n                    modal.getRoot().on(ModalEvents.save, function() {\n                        let request = {\n                            methodname: SERVICES.APPLYVERSION,\n                            args: {\n                                courseid: courseid,\n                                resourceid: resourceid,\n                                versionname: versionname\n                            }\n                        };\n                        Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n                            let identifier = $('body');\n                            identifier.append(html);\n                            Ajax.call([request])[0].done(function(response) {\n                                const d = new Date();\n                                if (response.response === true) {\n                                    Templates.render(TEMPLATES.SUCCESS, {message: langStrings[3] + d.toTimeString().split(' ')[0],\n                                        closebutton: true,\n                                        // eslint-disable-next-line max-nested-callbacks\n                                        announce: true}).done(function(htmlsuccess) {\n                                        $(REGION.CONTENT_CONTROLS).prepend(htmlsuccess);\n                                    });\n                                } else {\n                                    Templates.render(TEMPLATES.ERROR, {message: langStrings[4],\n                                        closebutton: true,\n                                        // eslint-disable-next-line max-nested-callbacks\n                                        announce: true}).done(function(htmlerror) {\n                                        $(REGION.CONTENT_CONTROLS).prepend(htmlerror);\n                                    });\n                                }\n                                if (response.responseprintable === true) {\n                                    Templates.render(TEMPLATES.SUCCESS, {message: langStrings[5] + d.toTimeString().split(' ')[0],\n                                        closebutton: true,\n                                        // eslint-disable-next-line max-nested-callbacks\n                                        announce: true}).done(function(htmlsuccess) {\n                                        $(REGION.CONTENT_CONTROLS).prepend(htmlsuccess);\n                                    });\n                                } else {\n                                    Templates.render(TEMPLATES.ERROR, {message: langStrings[6],\n                                        closebutton: true,\n                                        // eslint-disable-next-line max-nested-callbacks\n                                        announce: true}).done(function(htmlerror) {\n                                        $(REGION.CONTENT_CONTROLS).prepend(htmlerror);\n                                    });\n                                }\n                                $(REGION.OVERLAY).remove();\n                            }).fail(Notification.exception);\n                        });\n                    });\n                    modal.getRoot().on(ModalEvents.hidden, function() {\n                        modal.destroy();\n                    });\n                    return modal;\n                });\n            }).done(function(modal) {\n                modal.show();\n            }).fail(Notification.exception);\n        }\n    };\n\n    EditResource.prototype.changeVersion = function() {\n        let versionname = $('[data-region=\"select-version\"]').val();\n        if (versionname === 'original') {\n            $(ACTION.DELETEVERSION).prop('disabled', true);\n            $(ACTION.LOADVERSION).prop('disabled', true);\n            $(ACTION.EDITTOC).prop('disabled', true);\n            $(ACTION.PROCESSVERSIONLINKS).prop('disabled', true);\n        } else {\n            $(ACTION.DELETEVERSION).prop('disabled', false);\n            $(ACTION.LOADVERSION).prop('disabled', false);\n            $(ACTION.EDITTOC).prop('disabled', false);\n            $(ACTION.PROCESSVERSIONLINKS).prop('disabled', false);\n        }\n    };\n\n    EditResource.prototype.processVersionLinks = function(e) {\n        e.preventDefault();\n        e.stopPropagation();\n        if (hasChanges) {\n            EditResource.prototype.detectChanges(e);\n        } else {\n            let courseid = $(e.currentTarget).attr('data-courseid');\n            let resourceid = $(e.currentTarget).attr('data-resourceid');\n            let versionname = $(e.currentTarget).attr('data-versionname');\n            if (versionname === undefined) {\n                versionname = $('[data-region=\"select-version\"]').val();\n            }\n            let stringkeys = [\n                {key: 'process_version_links', component: 'local_educaaragon'},\n                {key: 'process_version_links_desc', component: 'local_educaaragon'},\n                {key: 'confirm', component: 'local_educaaragon'},\n                {key: 'processed_resource_links', component: 'local_educaaragon'},\n                {key: 'not_processed_resource_links', component: 'local_educaaragon'},\n            ];\n            Str.get_strings(stringkeys).then(function(langStrings) {\n                let title = langStrings[0];\n                let confirmMessage = langStrings[1];\n                let buttonText = langStrings[2];\n                return ModalFactory.create({\n                    title: title,\n                    body: confirmMessage,\n                    type: ModalFactory.types.SAVE_CANCEL\n                }).then(function(modal) {\n                    modal.setSaveButtonText(buttonText);\n                    modal.getRoot().on(ModalEvents.save, function() {\n                        let request = {\n                            methodname: SERVICES.PROCESSVERSIONLINKS,\n                            args: {\n                                courseid: courseid,\n                                resourceid: resourceid,\n                                versionname: versionname\n                            }\n                        };\n                        Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n                            let identifier = $('body');\n                            identifier.append(html);\n                            Ajax.call([request])[0].done(function(response) {\n                                const d = new Date();\n                                if (response.response === true) {\n                                    Templates.render(TEMPLATES.SUCCESS, {message: langStrings[3] + d.toTimeString().split(' ')[0],\n                                        closebutton: true,\n                                        // eslint-disable-next-line max-nested-callbacks\n                                        announce: true}).done(function(htmlsuccess) {\n                                        $(REGION.CONTENT_CONTROLS).prepend(htmlsuccess);\n                                        let resourceid = $(e.currentTarget).attr('data-resourceid');\n                                        if ($(ACTION.VIEWVERSIONLINKS).length > 0) {\n                                            let href = $(ACTION.VIEWVERSIONLINKS).attr('data-href');\n                                            let versionname = $('[data-region=\"select-version\"]').val();\n                                            let url = href + '?resourceid=' + resourceid + '&version=' + versionname;\n                                            let n = window.open(url, '_blank');\n                                            if (n === null) {\n                                                window.location.href = url;\n                                            }\n                                        }\n                                        if ($(ACTION.VIEWVERSIONLINKSEDIT).length > 0) {\n                                            let url = $(ACTION.VIEWVERSIONLINKSEDIT).attr('href');\n                                            let n = window.open(url, '_blank');\n                                            if (n === null) {\n                                                window.location.href = url;\n                                            }\n                                        }\n                                    });\n                                } else {\n                                    Templates.render(TEMPLATES.ERROR, {message: langStrings[4],\n                                        closebutton: true,\n                                        // eslint-disable-next-line max-nested-callbacks\n                                        announce: true}).done(function(htmlerror) {\n                                        $(REGION.CONTENT_CONTROLS).prepend(htmlerror);\n                                    });\n                                }\n                                $(REGION.OVERLAY).remove();\n                            }).fail(Notification.exception);\n                        });\n                    });\n                    modal.getRoot().on(ModalEvents.hidden, function() {\n                        modal.destroy();\n                    });\n                    return modal;\n                });\n            }).done(function(modal) {\n                modal.show();\n            }).fail(Notification.exception);\n        }\n    };\n\n    EditResource.prototype.viewVersionLinks = function(e) {\n        e.preventDefault();\n        e.stopPropagation();\n        let resourceid = $(e.currentTarget).attr('data-resourceid');\n        let href = $(e.currentTarget).attr('data-href');\n        let versionname = $('[data-region=\"select-version\"]').val();\n        let url = href + '?resourceid=' + resourceid + '&version=' + versionname;\n        window.open(url);\n    };\n\n    EditResource.prototype.detectChanges = function() {\n        if (hasChanges) {\n            modalChanges.show();\n        }\n    };\n\n    EditResource.prototype.createModalChanges = function() {\n        Str.get_strings(hasChangesStringsKeys).then(function(langStrings) {\n            hasChangesStrings = langStrings;\n            let title = hasChangesStrings[0];\n            let confirmMessage = hasChangesStrings[1];\n            let buttonText = hasChangesStrings[2];\n            ModalFactory.create({\n                title: title,\n                body: confirmMessage,\n                type: ModalFactory.types.SAVE_CANCEL\n            }).then(function(modal) {\n                modal.setSaveButtonText(buttonText);\n                modal.getRoot().on(ModalEvents.save, function() {\n                    $(ACTION.SAVECHANGES).click();\n                    modal.hide();\n                });\n                modalChanges = modal;\n            });\n            return true;\n        });\n    };\n\n    return {\n        /**\n         * Factory method returning instance of the Table\n         * @param {String} selector The selector for the table region containing the table.\n         * @return {EditResource}\n         */\n        initEditResource: function(selector) {\n            return new EditResource(selector);\n        }\n    };\n\n});\n"],"names":["define","$","Str","Ajax","ModalFactory","ModalEvents","Templates","Notification","ACTION","SERVICES","REGION","TEMPLATES","EditResource","selector","node","initEditResource","hasChangesStrings","modalChanges","hasChanges","hasChangesStringsKeys","key","component","prototype","find","on","this","createVersion","deleteVersion","loadVersion","editToc","saveChanges","applyVersion","processVersionLinks","viewVersionLinks","changeVersion","document","createModalChanges","querySelector","addEventListener","css","querySelectorAll","forEach","link","e","preventDefault","stopPropagation","detectChanges","window","onbeforeunload","courseid","currentTarget","attr","resourceid","versionname","val","asofversion","undefined","get_strings","then","langStrings","title","confirmMessage","buttonText","error","create","body","type","types","SAVE_CANCEL","modal","setSaveButtonText","getRoot","save","request","methodname","args","render","visible","done","html","identifier","append","call","response","url","location","href","indexOf","fail","exception","hidden","destroy","show","reload","replace","filename","htmlForBody","comment","length","substring","hide","other","btoa","d","Date","message","toTimeString","split","closebutton","announce","htmlsuccess","prepend","htmlerror","remove","stringkeys","responseprintable","prop","open","click"],"mappings":"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"}