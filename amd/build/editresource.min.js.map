{"version":3,"sources":["../src/editresource.js"],"names":["define","$","Str","Ajax","ModalFactory","ModalEvents","Templates","ACTION","CREATEVERSION","DELETEVERSION","LOADVERSION","SAVECHANGES","APPLYVERSION","CHANGEVERSION","PROCESSVERSIONLINKS","VIEWVERSIONLINKS","VIEWVERSIONLINKSEDIT","SERVICES","REGION","CONTENT_CONTROLS","CONTENT_ATTO_HTML","OVERLAY","TEMPLATES","LOADING","SUCCESS","ERROR","EditResource","selector","node","initEditResource","prototype","find","on","createVersion","deleteVersion","loadVersion","saveChanges","applyVersion","processVersionLinks","viewVersionLinks","changeVersion","document","e","preventDefault","stopPropagation","courseid","currentTarget","attr","resourceid","versionname","val","asofversion","get_strings","key","component","then","langStrings","title","confirmMessage","buttonText","error","create","body","type","types","SAVE_CANCEL","modal","setSaveButtonText","getRoot","save","request","methodname","args","render","visible","done","html","identifier","append","call","response","url","window","location","href","indexOf","fail","Notification","exception","hidden","destroy","show","reload","filename","htmlForBody","comment","length","substring","hide","other","btoa","d","Date","message","toTimeString","split","closebutton","announce","htmlsuccess","prepend","htmlerror","remove","responseprintable","prop","n","open"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @package local_educaaragon\n * @author 3iPunt <https://www.tresipunt.com/>\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @copyright 3iPunt <https://www.tresipunt.com/>\n */\n\ndefine([\n    'jquery',\n    'core/str',\n    'core/ajax',\n    'core/modal_factory',\n    'core/modal_events',\n    'core/templates'\n], function($, Str, Ajax, ModalFactory, ModalEvents, Templates) {\n    \"use strict\";\n\n    let ACTION = {\n        CREATEVERSION: '[data-action=\"createversion\"]',\n        DELETEVERSION: '[data-action=\"deleteversion\"]',\n        LOADVERSION: '[data-action=\"loadversion\"]',\n        SAVECHANGES: '[data-action=\"save-changes\"]',\n        APPLYVERSION: '[data-action=\"apply-version\"]',\n        CHANGEVERSION: '[data-action=\"change-version\"]',\n        PROCESSVERSIONLINKS: '[data-action=\"process-version-links\"]',\n        VIEWVERSIONLINKS: '[data-action=\"viewversionlinks\"]',\n        VIEWVERSIONLINKSEDIT: '[data-action=\"viewversionlinks_link\"]'\n    };\n\n    let SERVICES = {\n        CREATEVERSION: 'local_educaaragon_createversion',\n        DELETEVERSION: 'local_educaaragon_deleteversion',\n        SAVECHANGES: 'local_educaaragon_savechanges',\n        APPLYVERSION: 'local_educaaragon_applyversion',\n        PROCESSVERSIONLINKS: 'local_educaaragon_processresourcelinks'\n    };\n\n    let REGION = {\n        CONTENT_CONTROLS: '[data-region=\"educaaragon-editresource\"]',\n        CONTENT_ATTO_HTML: '.editor_atto_content',\n        OVERLAY: '[data-region=\"overlay-icon-container\"]'\n    };\n\n    let TEMPLATES = {\n        LOADING: 'core/overlay_loading',\n        SUCCESS: 'core/notification_success',\n        ERROR: 'core/notification_error'\n    };\n\n    /**\n     * @constructor\n     * @param {String} selector The selector for the page region containing the page.\n     */\n    function EditResource(selector) {\n        this.node = $(selector);\n        this.initEditResource();\n    }\n\n    /** @type {jQuery} The jQuery node for the page region. */\n    EditResource.prototype.node = null;\n\n    EditResource.prototype.initEditResource = function() {\n        this.node.find(ACTION.CREATEVERSION).on('click', this.createVersion);\n        this.node.find(ACTION.DELETEVERSION).on('click', this.deleteVersion);\n        this.node.find(ACTION.LOADVERSION).on('click', this.loadVersion);\n        this.node.find(ACTION.SAVECHANGES).on('click', this.saveChanges);\n        this.node.find(ACTION.APPLYVERSION).on('click', this.applyVersion);\n        this.node.find(ACTION.PROCESSVERSIONLINKS).on('click', this.processVersionLinks);\n        this.node.find(ACTION.VIEWVERSIONLINKS).on('click', this.viewVersionLinks);\n        this.changeVersion();\n        $(document).on('change', ACTION.CHANGEVERSION, this.changeVersion);\n    };\n\n    EditResource.prototype.createVersion = function(e) {\n        e.preventDefault();\n        e.stopPropagation();\n        let courseid = $(e.currentTarget).attr('data-courseid');\n        let resourceid = $(e.currentTarget).attr('data-resourceid');\n        let versionname = $('#newversion').val();\n        let asofversion = $('[data-region=\"select-asofversion\"]').val();\n        if (asofversion === undefined) {\n            asofversion = 'original';\n        }\n        let stringkeys = [\n            {key: 'createnewversion', component: 'local_educaaragon'},\n            {key: 'createnewversion_desc', component: 'local_educaaragon'},\n            {key: 'confirm', component: 'local_educaaragon'},\n            {key: 'errorcreateversion', component: 'local_educaaragon'}\n        ];\n        Str.get_strings(stringkeys).then(function(langStrings) {\n            let title = langStrings[0];\n            let confirmMessage = langStrings[1];\n            let buttonText = langStrings[2];\n            let error = langStrings[3];\n            return ModalFactory.create({\n                title: title,\n                body: confirmMessage,\n                type: ModalFactory.types.SAVE_CANCEL\n            }).then(function(modal) {\n                modal.setSaveButtonText(buttonText);\n                modal.getRoot().on(ModalEvents.save, function() {\n                    let request = {\n                        methodname: SERVICES.CREATEVERSION,\n                        args: {\n                            courseid: courseid,\n                            resourceid: resourceid,\n                            versionname: versionname,\n                            asofversion: asofversion,\n                        }\n                    };\n                    Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n                        let identifier = $(REGION.CONTENT_CONTROLS);\n                        identifier.append(html);\n                        Ajax.call([request])[0].done(function(response) {\n                            if (response.response === true) {\n                                let url = window.location.href;\n                                if (url.indexOf('?') > -1) {\n                                    url += '&version=' + response.versionname;\n                                } else {\n                                    url += '?version=' + response.versionname;\n                                }\n                                window.location.href = url;\n                            }\n                            if (response.response === false) {\n                                identifier.html('<div class=\"alert alert-danger\">' + error + '</div>');\n                            }\n                        }).fail(Notification.exception);\n                    });\n                });\n                modal.getRoot().on(ModalEvents.hidden, function() {\n                    modal.destroy();\n                });\n                return modal;\n            });\n        }).done(function(modal) {\n            modal.show();\n        }).fail(Notification.exception);\n    };\n\n    EditResource.prototype.deleteVersion = function(e) {\n        e.preventDefault();\n        e.stopPropagation();\n        let courseid = $(e.currentTarget).attr('data-courseid');\n        let resourceid = $(e.currentTarget).attr('data-resourceid');\n        let versionname = $('[data-region=\"select-version\"]').val();\n        let stringkeys = [\n            {key: 'deleteversion', component: 'local_educaaragon'},\n            {key: 'deleteversion_desc', component: 'local_educaaragon'},\n            {key: 'confirm', component: 'local_educaaragon'}\n        ];\n        Str.get_strings(stringkeys).then(function(langStrings) {\n            let title = langStrings[0];\n            let confirmMessage = langStrings[1];\n            let buttonText = langStrings[2];\n            return ModalFactory.create({\n                title: title,\n                body: confirmMessage,\n                type: ModalFactory.types.SAVE_CANCEL\n            }).then(function(modal) {\n                modal.setSaveButtonText(buttonText);\n                modal.getRoot().on(ModalEvents.save, function() {\n                    let request = {\n                        methodname: SERVICES.DELETEVERSION,\n                        args: {\n                            courseid: courseid,\n                            resourceid: resourceid,\n                            versionname: versionname\n                        }\n                    };\n                    Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n                        let identifier = $(REGION.CONTENT_CONTROLS);\n                        identifier.append(html);\n                        Ajax.call([request])[0].done(function(response) {\n                            if (response.response === true) {\n                                location.reload();\n                            }\n                        }).fail(Notification.exception);\n                    });\n                });\n                modal.getRoot().on(ModalEvents.hidden, function() {\n                    modal.destroy();\n                });\n                return modal;\n            });\n        }).done(function(modal) {\n            modal.show();\n        }).fail(Notification.exception);\n    };\n\n    EditResource.prototype.loadVersion = function(e) {\n        e.preventDefault();\n        e.stopPropagation();\n        let versionname = $('[data-region=\"select-version\"]').val();\n        let url = window.location.href;\n        if (url.indexOf('?') > -1) {\n            url += '&version=' + versionname;\n        } else {\n            url += '?version=' + versionname;\n        }\n        window.location.href = url;\n    };\n\n    EditResource.prototype.saveChanges = function(e) {\n        e.preventDefault();\n        e.stopPropagation();\n        let courseid = $(e.currentTarget).attr('data-courseid');\n        let resourceid = $(e.currentTarget).attr('data-resourceid');\n        let versionname = $(e.currentTarget).attr('data-versionname');\n        let filename = $(e.currentTarget).attr('data-filename');\n        let html = $(REGION.CONTENT_ATTO_HTML).html();\n        let stringkeys = [\n            {key: 'save_changes', component: 'local_educaaragon'},\n            {key: 'save_changes_desc', component: 'local_educaaragon'},\n            {key: 'confirm', component: 'local_educaaragon'},\n            {key: 'changes_saved', component: 'local_educaaragon'},\n            {key: 'not_saved', component: 'local_educaaragon'},\n            {key: 'write_comment', component: 'local_educaaragon'}\n        ];\n        Str.get_strings(stringkeys).then(function(langStrings) {\n            let title = langStrings[0];\n            let confirmMessage = langStrings[1];\n            let buttonText = langStrings[2];\n            let htmlForBody = '<p>' + confirmMessage + '</p>' +\n                '<div class=\"col-xl-12\">' +\n                '<div class=\"form-group purple-border mb-5\">' +\n                '<label for=\"write_comment\" class=\"\">' + langStrings[5] + '</label>' +\n                '<textarea maxlength=\"300\" class=\"form-control\" id=\"write_comment\" rows=\"3\"></textarea>' +\n                '</div>' +\n                '</div>';\n            return ModalFactory.create({\n                title: title,\n                body: htmlForBody,\n                type: ModalFactory.types.SAVE_CANCEL\n            }).then(function(modal) {\n                modal.setSaveButtonText(buttonText);\n                modal.getRoot().on(ModalEvents.save, function(e) {\n                    e.preventDefault();\n                    let comment = $('#write_comment').val();\n                    if (comment.length > 300) {\n                        comment = comment.substring(0, 300);\n                    }\n                    modal.hide();\n                    let request = {\n                        methodname: SERVICES.SAVECHANGES,\n                        args: {\n                            courseid: courseid,\n                            resourceid: resourceid,\n                            versionname: versionname,\n                            filename: filename,\n                            html: html,\n                            other: btoa(comment)\n                        }\n                    };\n                    Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n                        let identifier = $(REGION.CONTENT_CONTROLS);\n                        identifier.append(html);\n                        Ajax.call([request])[0].done(function(response) {\n                            const d = new Date();\n                            if (response.response === true) {\n                                Templates.render(TEMPLATES.SUCCESS, {message: langStrings[3] + d.toTimeString().split(' ')[0],\n                                    closebutton: true,\n                                    // eslint-disable-next-line max-nested-callbacks\n                                    announce: true}).done(function(htmlsuccess) {\n                                    $(REGION.CONTENT_CONTROLS).prepend(htmlsuccess);\n                                });\n                            } else {\n                                Templates.render(TEMPLATES.ERROR, {message: langStrings[4],\n                                    closebutton: true,\n                                    // eslint-disable-next-line max-nested-callbacks\n                                    announce: true}).done(function(htmlerror) {\n                                    $(REGION.CONTENT_CONTROLS).prepend(htmlerror);\n                                });\n                            }\n                            $(REGION.OVERLAY).remove();\n                        }).fail(Notification.exception);\n                    });\n                });\n                modal.getRoot().on(ModalEvents.hidden, function() {\n                    modal.destroy();\n                });\n                return modal;\n            });\n        }).done(function(modal) {\n            modal.show();\n        }).fail(Notification.exception);\n    };\n\n    EditResource.prototype.applyVersion = function(e) {\n        e.preventDefault();\n        e.stopPropagation();\n        let courseid = $(e.currentTarget).attr('data-courseid');\n        let resourceid = $(e.currentTarget).attr('data-resourceid');\n        let versionname = $(e.currentTarget).attr('data-versionname');\n        if (versionname === undefined) {\n            versionname = $('[data-region=\"select-version\"]').val();\n        }\n        let stringkeys = [\n            {key: 'apply_version', component: 'local_educaaragon'},\n            {key: 'apply_version_desc', component: 'local_educaaragon'},\n            {key: 'confirm', component: 'local_educaaragon'},\n            {key: 'version_saved', component: 'local_educaaragon'},\n            {key: 'version_not_saved', component: 'local_educaaragon'},\n            {key: 'versionprintable_saved', component: 'local_educaaragon'},\n            {key: 'versionprintable_not_saved', component: 'local_educaaragon'}\n        ];\n\n        Str.get_strings(stringkeys).then(function(langStrings) {\n            let title = langStrings[0];\n            let confirmMessage = langStrings[1];\n            let buttonText = langStrings[2];\n            return ModalFactory.create({\n                title: title,\n                body: confirmMessage,\n                type: ModalFactory.types.SAVE_CANCEL\n            }).then(function(modal) {\n                modal.setSaveButtonText(buttonText);\n                modal.getRoot().on(ModalEvents.save, function() {\n                    let request = {\n                        methodname: SERVICES.APPLYVERSION,\n                        args: {\n                            courseid: courseid,\n                            resourceid: resourceid,\n                            versionname: versionname\n                        }\n                    };\n                    Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n                        let identifier = $(REGION.CONTENT_CONTROLS);\n                        identifier.append(html);\n                        Ajax.call([request])[0].done(function(response) {\n                            const d = new Date();\n                            if (response.response === true) {\n                                Templates.render(TEMPLATES.SUCCESS, {message: langStrings[3] + d.toTimeString().split(' ')[0],\n                                    closebutton: true,\n                                    // eslint-disable-next-line max-nested-callbacks\n                                    announce: true}).done(function(htmlsuccess) {\n                                    $(REGION.CONTENT_CONTROLS).prepend(htmlsuccess);\n                                });\n                            } else {\n                                Templates.render(TEMPLATES.ERROR, {message: langStrings[4],\n                                    closebutton: true,\n                                    // eslint-disable-next-line max-nested-callbacks\n                                    announce: true}).done(function(htmlerror) {\n                                    $(REGION.CONTENT_CONTROLS).prepend(htmlerror);\n                                });\n                            }\n                            if (response.responseprintable === true) {\n                                Templates.render(TEMPLATES.SUCCESS, {message: langStrings[5] + d.toTimeString().split(' ')[0],\n                                    closebutton: true,\n                                    // eslint-disable-next-line max-nested-callbacks\n                                    announce: true}).done(function(htmlsuccess) {\n                                    $(REGION.CONTENT_CONTROLS).prepend(htmlsuccess);\n                                });\n                            } else {\n                                Templates.render(TEMPLATES.ERROR, {message: langStrings[6],\n                                    closebutton: true,\n                                    // eslint-disable-next-line max-nested-callbacks\n                                    announce: true}).done(function(htmlerror) {\n                                    $(REGION.CONTENT_CONTROLS).prepend(htmlerror);\n                                });\n                            }\n                            $(REGION.OVERLAY).remove();\n                        }).fail(Notification.exception);\n                    });\n                });\n                modal.getRoot().on(ModalEvents.hidden, function() {\n                    modal.destroy();\n                });\n                return modal;\n            });\n        }).done(function(modal) {\n            modal.show();\n        }).fail(Notification.exception);\n    };\n\n    EditResource.prototype.changeVersion = function() {\n        let versionname = $('[data-region=\"select-version\"]').val();\n        if (versionname === 'original') {\n            $(ACTION.DELETEVERSION).prop('disabled', true);\n            $(ACTION.LOADVERSION).prop('disabled', true);\n            $(ACTION.PROCESSVERSIONLINKS).prop('disabled', true);\n        } else {\n            $(ACTION.DELETEVERSION).prop('disabled', false);\n            $(ACTION.LOADVERSION).prop('disabled', false);\n            $(ACTION.PROCESSVERSIONLINKS).prop('disabled', false);\n        }\n    };\n\n    EditResource.prototype.processVersionLinks = function(e) {\n        e.preventDefault();\n        e.stopPropagation();\n        let courseid = $(e.currentTarget).attr('data-courseid');\n        let resourceid = $(e.currentTarget).attr('data-resourceid');\n        let versionname = $(e.currentTarget).attr('data-versionname');\n        if (versionname === undefined) {\n            versionname = $('[data-region=\"select-version\"]').val();\n        }\n        let stringkeys = [\n            {key: 'process_version_links', component: 'local_educaaragon'},\n            {key: 'process_version_links_desc', component: 'local_educaaragon'},\n            {key: 'confirm', component: 'local_educaaragon'},\n            {key: 'processed_resource_links', component: 'local_educaaragon'},\n            {key: 'not_processed_resource_links', component: 'local_educaaragon'},\n        ];\n        Str.get_strings(stringkeys).then(function(langStrings) {\n            let title = langStrings[0];\n            let confirmMessage = langStrings[1];\n            let buttonText = langStrings[2];\n            return ModalFactory.create({\n                title: title,\n                body: confirmMessage,\n                type: ModalFactory.types.SAVE_CANCEL\n            }).then(function(modal) {\n                modal.setSaveButtonText(buttonText);\n                modal.getRoot().on(ModalEvents.save, function() {\n                    let request = {\n                        methodname: SERVICES.PROCESSVERSIONLINKS,\n                        args: {\n                            courseid: courseid,\n                            resourceid: resourceid,\n                            versionname: versionname\n                        }\n                    };\n                    Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n                        let identifier = $(REGION.CONTENT_CONTROLS);\n                        identifier.append(html);\n                        Ajax.call([request])[0].done(function(response) {\n                            const d = new Date();\n                            if (response.response === true) {\n                                Templates.render(TEMPLATES.SUCCESS, {message: langStrings[3] + d.toTimeString().split(' ')[0],\n                                    closebutton: true,\n                                    // eslint-disable-next-line max-nested-callbacks\n                                    announce: true}).done(function(htmlsuccess) {\n                                    $(REGION.CONTENT_CONTROLS).prepend(htmlsuccess);\n                                    let resourceid = $(e.currentTarget).attr('data-resourceid');\n                                    if ($(ACTION.VIEWVERSIONLINKS).length > 0) {\n                                        let href = $(ACTION.VIEWVERSIONLINKS).attr('data-href');\n                                        let versionname = $('[data-region=\"select-version\"]').val();\n                                        let url = href + '?resourceid=' + resourceid + '&version=' + versionname;\n                                        let n = window.open(url, '_blank');\n                                        if (n === null) {\n                                            window.location.href = url;\n                                        }\n                                    }\n                                    if ($(ACTION.VIEWVERSIONLINKSEDIT).length > 0) {\n                                        let url = $(ACTION.VIEWVERSIONLINKSEDIT).attr('href');\n                                        let n = window.open(url, '_blank');\n                                        if (n === null) {\n                                            window.location.href = url;\n                                        }\n                                    }\n                                });\n                            } else {\n                                Templates.render(TEMPLATES.ERROR, {message: langStrings[4],\n                                    closebutton: true,\n                                    // eslint-disable-next-line max-nested-callbacks\n                                    announce: true}).done(function(htmlerror) {\n                                    $(REGION.CONTENT_CONTROLS).prepend(htmlerror);\n                                });\n                            }\n                            $(REGION.OVERLAY).remove();\n                        }).fail(Notification.exception);\n                    });\n                });\n                modal.getRoot().on(ModalEvents.hidden, function() {\n                    modal.destroy();\n                });\n                return modal;\n            });\n        }).done(function(modal) {\n            modal.show();\n        }).fail(Notification.exception);\n    };\n\n    EditResource.prototype.viewVersionLinks = function(e) {\n        e.preventDefault();\n        e.stopPropagation();\n        let resourceid = $(e.currentTarget).attr('data-resourceid');\n        let href = $(e.currentTarget).attr('data-href');\n        let versionname = $('[data-region=\"select-version\"]').val();\n        let url = href + '?resourceid=' + resourceid + '&version=' + versionname;\n        window.open(url);\n    };\n\n    return {\n        /**\n         * Factory method returning instance of the Table\n         * @param {String} selector The selector for the table region containing the table.\n         * @return {EditResource}\n         */\n        initEditResource: function(selector) {\n            return new EditResource(selector);\n        }\n    };\n\n});\n"],"file":"editresource.min.js"}