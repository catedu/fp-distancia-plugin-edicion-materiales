{"version":3,"sources":["../src/processedcourses_page.js"],"names":["define","$","Str","Ajax","ModalFactory","ModalEvents","Templates","ACTION","REPROCESSING_COURSE","SERVICES","PROCESSEDTABLE","REPROCESSING","REGION","CONTENT_TABLE","TABLE","TEMPLATES","LOADING","Table","selector","node","initReprocessingCourse","prototype","find","on","reprocessingCourse","e","preventDefault","stopPropagation","courseid","currentTarget","attr","get_strings","key","component","then","langStrings","title","confirmMessage","buttonText","create","body","type","types","SAVE_CANCEL","modal","setSaveButtonText","getRoot","save","identifier","render","visible","done","html","append","request","methodname","args","call","response","template","js","runTemplateJS","location","reload","fail","Notification","exception","hidden","destroy","show","initClicks"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @package local_educaaragon\n * @author 3iPunt <https://www.tresipunt.com/>\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @copyright 3iPunt <https://www.tresipunt.com/>\n */\n\ndefine([\n    'jquery',\n    'core/str',\n    'core/ajax',\n    'core/modal_factory',\n    'core/modal_events',\n    'core/templates'\n], function($, Str, Ajax, ModalFactory, ModalEvents, Templates) {\n    \"use strict\";\n\n    /**\n     *\n     * @property {string} REPROCESSING_COURSE - Selector for select course for reprocessing\n     */\n    let ACTION = {\n        REPROCESSING_COURSE: '[data-action=\"reprocessing_course\"]',\n    };\n\n    /**\n     *\n     * @property {string} PROCESSEDTABLE - Service for generate Table\n     * @property {string} REPROCESSING - Service for reprocessing course\n     */\n    let SERVICES = {\n        PROCESSEDTABLE: 'local_educaaragon_processed_table',\n        REPROCESSING: 'local_educaaragon_reprocessing'\n    };\n\n    /**\n     *\n     * @property {string} CONTENT_TABLE - Region for all reload\n     * @property {string} TABLE - Region for table reload\n     */\n    let REGION = {\n        CONTENT_TABLE: '[data-region=\"educaaragon-processedcourses\"]',\n        TABLE: '[data-region=\"processedcourses-table\"]'\n    };\n\n    let TEMPLATES = {\n        TABLE: 'local_educaaragon/processedcourses_table',\n        LOADING: 'core/overlay_loading'\n    };\n\n    /**\n     * @constructor\n     * @param {String} selector The selector for the page region containing the page.\n     */\n    function Table(selector) {\n        this.node = $(selector);\n        this.initReprocessingCourse();\n    }\n\n    /** @type {jQuery} The jQuery node for the page region. */\n    Table.prototype.node = null;\n\n    /**\n     * Register event listeners of clicks.\n     */\n    Table.prototype.initReprocessingCourse = function() {\n        this.node.find(ACTION.REPROCESSING_COURSE).on('click', this.reprocessingCourse);\n    };\n\n    Table.prototype.reprocessingCourse = function(e) {\n        e.preventDefault();\n        e.stopPropagation();\n        let courseid = $(e.currentTarget).attr('data-courseid');\n        let stringkeys = [\n            {key: 'reprocessing', component: 'local_educaaragon'},\n            {key: 'reprocessingmsg', component: 'local_educaaragon'},\n            {key: 'reprocess', component: 'local_educaaragon'}\n        ];\n        Str.get_strings(stringkeys).then(function(langStrings) {\n            let title = langStrings[0];\n            let confirmMessage = langStrings[1];\n            let buttonText = langStrings[2];\n            return ModalFactory.create({\n                title: title,\n                body: confirmMessage,\n                type: ModalFactory.types.SAVE_CANCEL\n            }).then(function(modal) {\n                modal.setSaveButtonText(buttonText);\n                modal.getRoot().on(ModalEvents.save, function() {\n                    let identifier = $(REGION.TABLE);\n                    Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n                        identifier.append(html);\n                        let request = {\n                            methodname: SERVICES.REPROCESSING,\n                            args: {\n                                courseid: courseid\n                            }\n                        };\n                        Ajax.call([request])[0].done(function() {\n                            let request = {\n                                methodname: SERVICES.PROCESSEDTABLE,\n                                args: {\n                                }\n                            };\n                            Ajax.call([request])[0].done(function(response) {\n                                let template = TEMPLATES.TABLE;\n                                Templates.render(template, response).done(function(html, js) {\n                                    identifier.html(html);\n                                    Templates.runTemplateJS(js);\n                                    location.reload();\n                                });\n                            }).fail(Notification.exception);\n                        }).fail(Notification.exception);\n                    });\n                });\n                modal.getRoot().on(ModalEvents.hidden, function() {\n                    modal.destroy();\n                });\n                return modal;\n            });\n        }).done(function(modal) {\n            modal.show();\n        }).fail(Notification.exception);\n    };\n\n    return {\n        /**\n         * Factory method returning instance of the Table\n         * @param {String} selector The selector for the table region containing the table.\n         * @return {Table}\n         */\n        initClicks: function(selector) {\n            return new Table(selector);\n        }\n    };\n});\n"],"file":"processedcourses_page.min.js"}